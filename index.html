<!doctype html>
<html lang="en">

    <!--
    
    # Amniocentesis Advisor
    ==========================================================================================
    
    Copyright (c) 2015 by Stephen Thomas. 
    Open sourced under [MIT License](http://opensource.org/licenses/MIT).

    This is a single-page web application that offers advice on amniocentesis testing
    for expectant mothers and families. The application relies on decision theory
    [need reference] to help patients make a more informed choice that balances the
    risks and benefits of the procedure against their personal priorities.
    
    Currently the application is implemented completely within a single `index.html`
    file. This optimizes performance, especially over mobile networks, by minimizing
    the number of network requests. As the app gets more complex, however, it will
    likely be broken up into (at least) separate HTML, CSS, and JavaScript files. It may
    also be beneficial to minimize the content (including removing comments).
    
    Note that the application does not use any templating for constructing the markup.
    This approach is also chosen to optimize performance, in this case to minimize time
    to full render.

    -->
    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Amniocentesis Advisor</title>
        <meta name="description" 
              content="Web application that advises patients on amniocentesis testing">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">
    
        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Amnio Advisor">
        <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-precomposed.png">
    
        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" 
              content="images/touch/ms-touch-icon-144x144-precomposed.png">
        <meta name="msapplication-TileColor" content="#3372DF">

        <!--
            
        ## Styles
        --------------------------------------------------------------------------------------
        
        Most of the styles rely on standard Material Design Lite (MDL) stylesheets delivered
        from Google's CDN; however, we do have some local style definitions and we need to
        override a few of the MDL defaults.
        
        First we include the standard MDL font (Roboto) and the icon font. Those are followed
        by a themed MDL stylesheet. Note that the Roboto font may be commented out and the
        application will fall back to Helvetica on all devices except Andriod. This saves
        a network request and about 1.3 MBytes (uncompressed) of download data.
        
        > Note: If the MDL style sheet is updated to a new version, the corresponding
          script (see below) probably also needs updating.
        
        After the included style sheets we define our own local styles.
        
        -->

        <!--
        <link rel="stylesheet" type="text/css"
              href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
         -->
        <link rel="stylesheet" type="text/css"
              href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" type="text/css"
              href="https://storage.googleapis.com/code.getmdl.io/1.0.4/material.indigo-pink.min.css">
        
        <style>
            
            /*
             * ### Generic Styles
             */

            /*
             * Tweak the display of `<legend>` elements, which we
             * use as "super-labels" for fieldsets.
             */
            
            legend {
                padding-top: 1em;
            }
            
            /*
             * Get rid of the spinners on number inputs.
             */
            
            input[type=number]::-webkit-inner-spin-button,
            input[type=number]::-webkit-outer-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            input[type=number] {
                -moz-appearance:textfield;
            }
            
            /*
             * ### MDL Adjustments
             */
            
            /*
             * Adjust the margins and padding because all the content
             * appears in cards,
             */
            
            .mdl-card {
                margin: 16px;
                max-width: 600px;
                width: auto;
            }
            
            .mdl-card__supporting-text > p:not(:first-of-type) {
                margin-top: 1.5em;
            }
            
            .mdl_card__supporting-text__note {
                padding: 0 8px;
            }
            
            /*
             * Correct some problems with validation error messages
             * on desktop Safari.
             */
            
            .mdl-textfield--floating-label.is-invalid .mdl-textfield__label {
                top: 4px;
            }
            
            .mdl-textfield__error {
                left: 0;
                top: 48px;
            }
            
            .info {
                margin-bottom: 5px;
            }
            
            /*
             * ### Custom Components
             */
            
            /*
             * #### Rating Component
             */
            
            /*
             * The `rating` component is an enhanced version of the
             * material design slider with several additional features.
             * For details on the component, refer to the JavaScript
             * code below. The unique styles for the component follow.
             */
            
            fieldset div.rating {
                padding-top: 0.5em;
            }

            fieldset div.rating:last-child {
                padding-bottom: 2.2em;
            }
            
            .rating {
                width: 108%;
            }

            .rating > label {
                display: block;
                padding-left: 1em;
                padding-top: 1em;
            }
            
            .rating > .mdl-slider__container {
                float: left;
                top: 6px;
                width: calc(100% - 72px);
            }
            
            .rating > .mdl-slider__container > .mdl-slider__background-flex {
                -webkit-transform: translate(0,3px);
                    -ms-transform: translate(0,3px);
                        transform: translate(0,3px);
            }
            
            .rating > i {
                float: left;
                position: relative;
                top: 8px;
            }
            
            .rating > i:first-of-type {
                left: 8px;
            }
            
            .rating input[type=range] {
                position: absolute;
                top: 13px;
            }

            .rating > i:last-of-type {
                right: 8px;
            }
            
            .rating--keys {
                display: table;
                position: relative;
                left: calc(36px - 16px);
                top: 6px;
                width: calc(100% + 16px - 72px);
            }
            
            .rating--key {
                display: table-cell;
                opacity: 0;
                text-align: center;
                width: 20%;
            }
            
            /*
             * #### Gauge Component
             *
             * The standard markup for the component is:
             *
             *      <div class="gauge">
             *          <div class="gauge--container">
             *              <div class="gauge--marker"></div>
             *              <div class="gauge--background"></div>
             *              <div class="gauge--center"></div>
             *              <div class="gauge--data"></div>
             *              <div class="gauge--needle"></div>
             *          </div>
             *          <div class="gauge--labels">
             *              <span class="gauge--label__low">No</span>
             *              <span class="gauge--label__spacer"></span>
             *              <span class="gauge--label__high">Yes</span>
             *          </div>
             *      </div>
             */
             
            /*
             * First define all of the relevant rules that aren't dependent
             * on the size of the gauge. We want to collect the size-depenent
             * rules in one place to make it easier to adjust the size.
             */

            .gauge {
                position: relative;
            }

            .gauge--container {
            	margin: 0;
            	padding: 0;
            	position: absolute;
            	left: 50%;
            	overflow: hidden;
            	text-align: center;
            	-webkit-transform: translateX(-50%);
            	   -moz-transform: translateX(-50%);
            	    -ms-transform: translateX(-50%);
            	     -o-transform: translateX(-50%);
            	        transform: translateX(-50%);
            }
            
            .gauge--marker {
                background-color: #fff;
                position: absolute;
                width: 1px;
                z-index: 4;
            }
            
            .gauge--background {
            	z-index: 1;
            	position: absolute;
            	background-color: #C5CAE9;
            	top: 0;
            	border-radius: 300px 300px 0 0;
            }

            .gauge--center {
            	z-index: 3;
            	position: absolute;
            	background-color: #fff;
            	margin-right: auto;
            	border-radius: 300px 300px 0 0;
            }

            .gauge--data {
            	z-index: 2;
            	position: absolute;
            	background-color: #3F51B5;
            	margin-left: auto;
            	margin-right: auto;
            	border-radius: 0 0 300px 300px ;
                -webkit-transform-origin: center top;
                   -moz-transform-origin: center top;
                    -ms-transform-origin: center top;
                     -o-transform-origin: center top;
                        transform-origin: center top;
            }
            
            .gauge--needle {
                background-color: #E91E63;
                height: 3px;
                position: absolute;
                z-index: 5;
                -webkit-transform-origin: left center;
                   -moz-transform-origin: left center;
                    -ms-transform-origin: left center;
                     -o-transform-origin: left center;
                        transform-origin: left center;
            }

            .gauge--labels {
                display: table;
                margin: 0 auto;
                position: relative;
            }
            
            .gauge--label__low {
                display: table-cell;
                text-align: center;
            }
            
            .gauge--label__spacer {
                display: table-cell;
            }
            
            .gauge--label__high {
                display: table-cell;
                text-align: center;
            }
            
            /*
             * Now define the rules that depend on the size of
             * the gauge. We start with sizing for a small mobile
             * device.
             */

            .gauge { height: calc(120px + 3em); }
            .gauge--container { width: 240px; height: 120px; }
            .gauge--marker { height: 120px; left: 119.5px; }
            .gauge--background { width: 240px; height: 120px; }
            .gauge--center { width: 144px; height: 72px; top: 48px; margin-left: 48px; }
            .gauge--data { width: 240px; height: 120px; top: 120px; }
            .gauge--needle { left: 120px; top: 117px; width: 120px; }
            .gauge--labels { top: 120px; width: 240px; }
            .gauge--label__low { width: 48px; }
            .gauge--label__spacer { width: 144px; }
            .gauge--label__high { width: 48px; }

            /*
             * Increase the gauge size slightly on larger viewports.
             */

             @media only screen and (min-width: 400px) {
                .gauge { height: calc(150px + 3em); }
                .gauge--container { width: 300px; height: 150px; }
                .gauge--marker { height: 150px; left: 149.5px; }
                .gauge--background { width: 300px; height: 150px; }
                .gauge--center { width: 180px; height: 90px; top: 60px; margin-left: 60px; }
                .gauge--data { width: 300px; height: 150px; top: 150px; }
                .gauge--needle { left: 150px; top: 147px; width: 150px; }
                .gauge--labels { top: 150px; width: 300px; }
                .gauge--label__low { width: 60px; }
                .gauge--label__spacer { width: 180px; }
                .gauge--label__high { width: 60px; }
            }

            /*
             * As an option, the `gauge__liveupdate` class can be added
             * to the main gauge element. When this class is present,
             * we add a transition that animates any changes to the gauge
             * value. Currently, the app does not use this option because
             * all the inputs that can change gauge values are present
             * on tab panels that are different from the gauge itself.
             * Therefore, users won't be able to see any gauge changes
             * when they make input changes. The code is available, though,
             * should this change.
             */

            .gauge__liveupdate .gauge--data,
            .gauge__liveupdate .gauge--needle {
                -webkit-transition: all 1.5s ease-in-out;
                   -moz-transition: all 1.5s ease-in-out;
                    -ms-transition: all 1.5s ease-in-out;
                     -o-transition: all 1.5s ease-in-out;
                        transition: all 1.5s ease-in-out;
            }            

            /*
             * For a given gauge value, x, ranging from 0.0 to 1.0, set
             * the `transform: rotate()` property according to the
             * following equations:
             *
             * - `.gauge--data`: 0.5x turns
             * - `.gauge--needle`: -0.5 + 0.5x turns
             */

            .gauge--data {
                -webkit-transform: rotate(0turn);
                   -moz-transform: rotate(0turn);
                    -ms-transform: rotate(0turn);
                     -o-transform: rotate(0turn);
                        transform: rotate(0turn);
            }
            .gauge--needle {
                -webkit-transform: rotate(-.50turn);
                   -moz-transform: rotate(-.50turn);
                    -ms-transform: rotate(-.50turn);
                     -o-transform: rotate(-.50turn);
                        transform: rotate(-.50turn);
            }

            /*
             * #### Bar Component
             */

             .bar {
                 position: relative;
                 left: 8px;
                 height: calc(2em + 16px);
                 width: calc(100% - 16px);
             }
             
             .bar--background {
                 background-color: #C5CAE9;
                 height: 16px;
                 position: absolute;
                 top: 0;
                 left: 0;
                 width: 100%;
             }
             
            .bar--data {
                background-color: #3F51B5;
                border-right: 1px solid #E91E63;
                box-shadow: -1px 0px 0px 0 #E91E63 inset;
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 0%;
                z-index: 1;
            }
            
            .bar--text {
                display: inline-block;
                position: absolute;
                top: 16px;
                left: calc(0% - 8.5px);
            }

            /*
             * ### Content Visibility
             *
             * Show/hide content based on the application state. There are three
             * classes that determine main content visibility:
             *
             * 1. `results__notready`: Content within a container with this
             *    class is visible when the results are not ready. The content
             *    is generally a prompt for the user to provide the information
             *    needed to generate results.
             * 2. `results__ready`: Content within a container with this class
             *    is visible when the analysis is complete.
             * 3. `results__suspect`: Content within a container with this
             *    class is visible when analysis results are available but
             *    could be improved with better input. The content is 
             *    generally a suggestion to the user for improving the input.
             *
             * Initially, only the `results__notready` content is visible. To change
             * the content visibility, JavaScript code adds appropriate `data-`
             * attributes to the `<body>` element. (We use `data-` attributes
             * instead of classes so that it's clear when a style is affected
             * by JavaScript code. JavaScript only sets `data-` attributes; and
             * only JavaScript sets `data-` attributes.)
             *
             * * `data-results`: set to `"true"` when results are available.
             * * `data-suspect`: set to `"true"` if results are suspect.
             *
             * For completeness, we also support `data-results-notready` but its
             * use is discouraged.
             *
             * There are also distinct classes to mark content based on whether
             * or not an amniocentesis is advisable. Those classes are:
             *
             * - `amnio-false` if amniocentesis is not advised, and
             * - `amnio-true` if amniocentesis is advised.
             *
             * Initially, both content types are hidden. The appropriate content
             * can be revealed by setting the `data-amnio` attribute on the
             * `<body>` tag to be "true" or "false".
             */

            .results__notready {
                display: block;
            }
            
            .results__ready {
                display: none;
            }
            
            .results__suspect {
                display: none;
            }

            body[data-results-ready="true"]     .results__notready,
            body[data-results-notready="false"] .results__notready {
                display: none;                
            }

            body[data-results-ready="true"]     .results__ready,
            body[data-results-notready="false"] .results__ready {
                display: block;
            }
            
            body[data-results-suspect="true"] .results__suspect {
                display: block;
            }
            
            .amnio-false, .amnio-true {
                display: none;
            }
            
            body[data-amnio="true"] .amnio-true {
                display: block;
            }

            body[data-amnio="false"] .amnio-false {
                display: block;
            }
        </style>

    </head>
    
    <!--
        
    ## Markup (HTML)
    ------------------------------------------------------------------------------------------
    
    Not too much to say about the markup at a high level. It's pretty much standard
    Material Design Lite. We are currently using the `-force-preferred-font` suffix
    for typography classes to ensure that a consistent font is used throughout the
    application. That may change if we get around to implementing conditional font-face
    application based on available system fonts (which is ideal, but a lot of work).
    
    -->

    <body class="mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">

        <!--
        
        ### IE8 (and Older) Fallback
            
        Hopefully we don't have to worry about IE8 any more, but just in
        case, we use conditional comments to detect it. If we do find
        IE8, add a note suggesting that the user upgrade the browser.
        We don't bother to spend any time formatting the note, etc.
        
        -->

        <!--[if lt IE 9]>
            <p class="browserupgrade">
                You are using an <strong>outdated</strong> browser. Please 
                <a href='http://browsehappy.com/'>upgrade your browser</a> 
                to improve your experience.
            </p>
        <![endif]-->

        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs">

            <!--

            ### Application Navigation Header
            
            Although MDL generally uses tabs as a component within a page, we're using
            it for the overall application structure. For accessibility, we use semantic
            elements instead of generic `<div>` tags.

            -->

            <header class="mdl-layout__header mdl-color--primary">
                <nav class="mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark 
                            mdl-typography--body-2-force-preferred-font">
                    <a href="#welcome" class="mdl-layout__tab is-active">Welcome</a>
                    <a href="#info" class="mdl-layout__tab">Info</a>
                    <a href="#priorities" class="mdl-layout__tab">Priorities</a>
                    <a href="#advice" class="mdl-layout__tab">Advice</a>
                    <a href="#details" class="mdl-layout__tab">Details</a>
                </nav>
            </header>
            
            <main class="mdl-layout__content">

                <!--

                ### Welcome Panel
                
                The first tab panel is a general welcome screen. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel is-active" id="welcome">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp demo-card-event">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Amniocentesis Advisor</h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Welcome and introductory information here.
                                </p>
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    <em>If you have stumbled across this application on the
                                    internet, please note that this is a non-functioning
                                     prototype. It does <strong>not</strong> provide actual
                                     advice.</em>
                                </p>
                				<p class="mdl-typography--body-1-force-preferred-font">
                    				For more information, you can visit the following web sites:
                                </p>
                				<p>
                    				<ul class="mdl-typography--body-1-force-preferred-font">
                    					<li><a href="http://www.cdc.gov/ncbddd/birthdefects/features/key-findings-down-syndrome-prevalence.html">
                        					Prevalence of Down syndrome in the United States
                        				</a></li>
                    					<li><a href="http://www.cdc.gov/ncbddd/birthdefects/diagnosis.html">
                        					Diagnosis for birth defects
                        				</a></li>
                    					<li><a href="http://www.ndss.org/">
                        					National Down Syndrome Society
                        				</a></li>
                    					<li><a href="http://www.ndsccenter.org/">
                        					National Down Syndrome Congress
                        				</a></li>
                    					<li><a href="http://www.ds-int.org/">
                        					Down Syndrome International
                        				</a></li>
                    					<li><a href="http://www.nlm.nih.gov/medlineplus/downsyndrome.html">
                        					Medline
                        				</a></li>
                    					<li><a href="http://www.mayoclinic.org/diseases-conditions/down-syndrome/basics/definition/con-20020948">
                        					Mayo Clinic
                        				</a></li>
                    				</ul>
                				</p>
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    <em>Note:</em> Your information is completely private. We
                                    do not store or save any of your information on our
                                     servers. Nor do we use any cookies.
                                </p>
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Get started by telling us some basic medical information.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised 
                                               mdl-js-ripple-effect mdl-button--primary" 
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Medical Information
                
                The next tab panel collects medical information. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="info">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp demo-card-event">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Medical Information</h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    In addition to some general information, we need to know
                                    the results from lab tests performed during your first
                                    and second trimesters. Your doctor can tell you the test
                                    result values.
                                </p>

                                <!--

                                Enclose the inputs within a `<form>` element so that we
                                can easily check validity of all inputs. See JavaScript
                                below for details.
                                
                                -->

                                <form action="#">

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            General information:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" 
                                                   type="number" min="1" max="99" id="infoAge" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font" 
                                                   for="age">
                                                How old are you?
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 1 and 99
                                            </span>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            First trimester lab test results:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number" 
                                                min="0.5" max="2.5" step="any" id="infoNt" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="nt">
                                                Nuchal Translucency (NT)
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.5 and 2.5 (MoM)
                                            </span>
                                        </div>
                                        <div class="mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.2" max="3.0" step="any" id="infoPappa" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font" 
                                                   for="pappa">
                                                PAPP-A
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.2 and 3.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="mdl-textfield 
                                                    mdl-js-textfield mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.3" max="5.0" step="any" id="infoFbhcg" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="fbhcg">
                                                fbhCG
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.3 and 5.0 (MoM)
                                            </span>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            Second trimester lab test results:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.4" max="3.0" step="any" id="infoAfp" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font" 
                                                   for="apf">
                                                Alpha-Feprotein (AFP)
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 3.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield 
                                                    mdl-js-textfield mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.4" max="2.0" step="any" id="infoUe3" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font" 
                                                   for="ue3">
                                                Unconjugated Estriol (uE3)
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 2.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.3" max="5.0" step="any" id="infoInhibina" />
                                            <label class="mdl-textfield__label 
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="inhibina">
                                                Inhibin-A
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.3 and 5.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield mdl-js-textfield 
                                                    mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number" 
                                                   min="0.4" max="5.0" step="any" id="infoHgc" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font" 
                                                   for="hgc">
                                                   Total hGC
                                            </label>
                                            <span class="mdl-textfield__error 
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 5.0 (MoM)
                                            </span>
                                        </div>
                                    </fieldset>

                                </form>

                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Next, help us understand your concerns and priorities.
                                </p>

                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--primary
                                               mdl-button--raised mdl-js-ripple-effect" 
                                        data-onclick="priorities">
                                    Priorities
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Patient Priorities
                
                The next tab panel accepts patient priority data. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="priorities">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp demo-card-event">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Your priorities</h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    To help us understand your priorities, please tell us how
                                    you feel about the following possible outcomes.
                                </p>
                                
                                <!--

                                Enclose the inputs within a `<form>` element so that we
                                can easily check validity of all inputs. See JavaScript
                                below for details.
                                
                                -->

                                <form action="#">

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you <strong>don't</strong> have an 
                                            amniocentesis:
                                        </legend>
                                        <div class="rating">
                                            <label for="notest_healthy" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born healthy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingNotest_healthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="notest_ds" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born with Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingNotest_ds" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="notest_still" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby has Down Syndrome but is stillborn
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingNotest_still" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that shows 
                                            <strong>no</strong> Down Syndrome:
                                        </legend>
                                        <div class="rating">
                                            <label for="test_healthy" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born healthy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingTest_healthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that shows 
                                            Down Syndrome:
                                        </legend>
                                        <div class="rating">
                                            <label for="test_term" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And you terminate the pregnancy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingTest_term" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="test_ds" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born with Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingTest_ds" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="test_still" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is stillborn
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingTest_still" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                   </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that results in 
                                            a miscarriage:
                                        </legend>
                                        <div class="rating">
                                            <label for="mis_ds" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby had Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingMis_ds" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="mis_healthy" 
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby did <strong>not</strong> have
                                                Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider" 
                                                   type="range" min="0" max="10" step="0.01" 
                                                   value="5" tabindex="0" id="ratingMis_healthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys 
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                   </fieldset>

                                </form>

                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Based on your information and priorities, we can
                                    offer some advice on an amniocentesis.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised 
                                               mdl-js-ripple-effect mdl-button--primary" 
                                        data-onclick="advice">
                                    Advice
                                </button>
                            </div>
                        </div>
                    </div>
                </section>


                <!--

                ### Suggested Action
                
                The next tab panel shows the suggested action (at a high level). Like all
                panels, it is implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="advice">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp demo-card-event 
                                    results__notready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Is Amniocentesis Recommended?
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Before we can offer any suggestions, we need some 
                                    basic medical information.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary" 
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp demo-card-event results__ready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Is Amniocentesis Recommended?
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text results__suspect">
                                <hr/>
                                <p class="mdl-typography--body-1-force-preferred-font 
                                          mdl_card__supporting-text__note">
                                    <em>Note:</em> We can give you better advice if you 
                                    pick a wider range of values for your priorities. Would
                                    you like to review them now?
                                </p>
                                <a class="mdl-button mdl-button--colored mdl-js-button 
                                          mdl-js-ripple-effect" 
                                   data-onclick="priorities">
                                    Review Priorities
                                </a>
                                <hr/>
                            </div>
                            <div class="mdl-typography--body-1-force-preferred-font 
                                        mdl-card__supporting-text mdl-card--border">
                            	<div class="gauge" id="gaugeResult">
                                	<div class="gauge--container">
                                		<div class="gauge--marker"></div>
                                		<div class="gauge--background"></div>
                                		<div class="gauge--center"></div>
                                		<div class="gauge--data"></div>
                                		<div class="gauge--needle"></div>
                                	</div>
                                	<div class="gauge--labels mdl-typography--headline">
                                    	<span class="gauge--label__low">No</span>
                                    	<span class="gauge--label__spacer"></span>
                                    	<span class="gauge--label__high">Yes</span>
                                	</div>
                            	</div>
                                <p class="amnio-true 
                                          mdl-typography--body-1-force-preferred-font">
                                    Based on your priorities and medical information,
                                    an amniocentesis will improve your chances of
                                    a more desirable outcome. We suggest that you have
                                    the procedure.
                                </p>
                                <p class="amnio-false 
                                          mdl-typography--body-1-force-preferred-font">
                                    Based on your priorities and medical information,
                                    an amniocentesis will not improve your chances of
                                    a more desirable outcome. We suggest that you do
                                    <strong>not</strong> have the procedure.
                                </p>
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    You can look at the details to understand how
                                    we came to this suggestion.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised 
                                               mdl-js-ripple-effect mdl-button--primary" 
                                        data-onclick="details">
                                    Details
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Detailed Analysis
                
                The next tab panel provides details of the analysis. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="details">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp demo-card-event 
                                    results__notready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Detailed Analysis
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <p class="mdl-typography--body-1-force-preferred-font">
                                    Before we can provide a detailed analysis, we need some 
                                    basic medical information.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised 
                                               mdl-js-ripple-effect mdl-button--primary" 
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp demo-card-event results__ready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Detailed Analysis
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text results__suspect">
                                <hr/>
                                <p class="mdl-typography--body-1-force-preferred-font 
                                          mdl_card__supporting-text__note">
                                    <em>Note:</em> We can give you better advice if you 
                                    pick a wider range of values for your priorities. Would
                                    you like to review them now?
                                </p>
                                <a class="mdl-button mdl-button--colored mdl-js-button 
                                          mdl-js-ripple-effect" 
                                   data-onclick="priorities">
                                    Review Priorities
                                </a>
                                <hr/>
                            </div>
                            <div class="mdl-typography--body-1-force-preferred-font 
                                        mdl-card__supporting-text mdl-card--border">
                                <p class="mdl-typography--body-1-force-preferred-font 
                                          mdl_card__supporting-text__note">
                                    First we estimate the chance of a Down Syndrome
                                    pregnancy for an average women of your age:
                                    <div id="barBaseline" class="bar">
                                        <div class="bar--background">
                                            <div class="bar--data"></div>
                                        </div>
                                        <span class="bar--text">0%</span>
                                    </div>
                                </p>
                                <p class="mdl-typography--body-1-force-preferred-font
                                          mdl_card__supporting-text__note">
                                    If you wish, you can adjust your priorities to see
                                    how they might change our advice.
                                </p>
                                <a class="mdl-button mdl-button--colored mdl-js-button 
                                          mdl-js-ripple-effect" 
                                   data-onclick="priorities">
                                    Adjust Priorities
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            
            <!--

            ### Application Footer
            
            An optional application footer with links to, e.g., about the site,
            privacy policy, etc. Currently, the welcome panel provides this
            information, so no footer is necessary. In that case, the footer
            can be commented out.

            -->

            <!--
            <footer class="mdl-mini-footer mdl-color--primary">
                <div class="mdl-mini-footer__left-section">
                    <ul class="mdl-mini-footer__link-list">
                        <li><a href="#">About</a></li>
                        <li><a href="#">Privacy & Terms</a></li>
                    </ul>
                </div>
            </footer>
             -->

        </div>
        
        <!--
        
        ## Scripts
        --------------------------------------------------------------------------------------
        
        The only external script required by the application is the Material Design
        Lite script, which we get from Google's CDN.
        
        > Note: If the MDL script file is updated to a newer version, the CSS style
          sheet (see above) should probably also be updated to match.
        
        Code for some optional scripts is included below, though currently commented out.
        
        1. An in-app feedback option. Since this app has no server support, we
           use an external service ([Eager](https://eager.io)) to add a feedback
           option. Note that any feedback received is (currently) sent to me
           (stephen@sathomas.me), so subsequent owners probably should update
           the link to their own account.
        
        2. Standard Google Analytics boilerplate. There's no account (yet), so the site
           ID is left unspecified in the commented out code.
           
        > Note: If either of these third party services (or any other, for that
          matter) is enabled, the privacy statement on the welcome panel should
          be updated appropriately. Third party services are almost certainly
          collecting _some_ data.
          
        After loading the external script files, we define our own local code.
        That code is really the heart of the application.
        
        -->

        <script src="https://storage.googleapis.com/code.getmdl.io/1.0.4/material.min.js"></script>

        <!-- Third party service that adds support for in-app feedback
        <script src='http://fast.eager.io/KBgHZ9aQoe.js'></script>
        -->

        <!-- Google Analytics: change UA-XXXXX-X to actual site ID
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,"script","ga"));
            ga("create","UA-XXXXX-X","auto");ga("send","pageview");
        </script>
        -->
        
        <script>
            
            // ### Generic Utility Functions
    
            // #### hasLocalStorage()

            // Check to see if HTML5 localStorage is available. Returns
            // a boolean result.
            
            var hasLocalStorage = function() {
            	try {
            		var storage = window.localStorage,
            			x = '__storage_test__';
            		storage.setItem(x, x);
            		storage.removeItem(x);
            		return true;
            	}
            	catch(e) {
            		return false;
            	}
            }

            // ### Application State

            // State of the overall application that is shared by multiple
            // components.

            var hasInputChanged = false,    // has the user changed *any* input?
                hasVisitedResults = false,  // has the user visisted a results panel?
                areInputsValid = false,     // are all inputs valid?
                areInputsSuspect = false,   // are inputs suspect?
                weights = {
                    amnio: 0,               // weighted value of procedure
                    noAmnio: 0              // weighted value of no procedure
                },
                bars = {
                    barBaseline: 0          // probability for baselien
                },
                inputVars = {},             // hash of all input objects
                inputs = [],                // array of all input objects
                infos = [],                 // array of all info objects
                ratings = [],               // array of all rating objects
                resultGauge,                // the result gauge object
                barVars = {};               // hash of all bar objects
                
            // ### Application-specific Utility Functions
            
            // #### evaluateInputs()
            
            // Evaluate the user inputs, updating application state as appropriate.

            var evaluateInputs = function() {

                // Get the range of rating values. We need this to determine whether
                // or not the results are "suspect."
                var minRating = Math.min.apply(null, ratings.map(function(r) {
                    return r.value();})
                );
                var maxRating = Math.max.apply(null, ratings.map(function(r) {
                    return r.value();})
                );
                                
                // Are all the inputs ready and valid?
                areInputsValid = inputs.every(function(i) {
                        // If an input is required, its value can't be undefined.
                        return !i.required() || typeof i.value() !== "undefined";
                    }) && 
                    [].slice.call(document.getElementsByTagName("form")).every(function(f) {
                        // And, in addition, all form elements should validate.
                        return f.checkValidity();
                    });
                
                // Two conditions cause suspect inputs:
                //   1. The range of values for min and max ratings are limited
                //   2. Every rating is an extreme.
                areInputsSuspect = ((maxRating - minRating) < 4) ||
                    ratings.every(function(r) {return r.value() < 1 || r.value() > 9;});

            };
            
            // #### calculateResults()
            
            // Run the algorithm to calculate results
            
            var calculateResults = function() {
                
                weights.amnio = Math.random()*10;
                weights.noAmnio = Math.random()*10;
                
                for (bar in bars) {
                    bars[bar] = Math.random();
                }

            };
            
            // #### updateResults()
            
            // Update the results from the calculations
            
            var updateResults = function() {
                
                // Update the main gauge.
                resultGauge.value((10 + (weights.amnio - weights.noAmnio))/20);
                
                // Update the probability bars.
                for (bar in barVars) {
                    barVars[bar].value(bars[bar]);
                }

            };

            // #### updateContentVisibility()
            
            // Update the `data-` attributes that control content visibility.

            var updateContentVisibility = function() {
                
                // Add an attribute to the markup so that CSS rules can change
                // visibility appropriately.
                var body = document.getElementsByTagName("body")[0];
                body.setAttribute("data-results-ready", areInputsValid);
                body.setAttribute("data-results-suspect", areInputsValid && areInputsSuspect);
                body.setAttribute("data-amnio", weights.amnio > weights.noAmnio);

            };
            
            // #### saveInputState()
            
            // Save the state of all inputs in local storage (so it can be restored
            // if/when the user reloads the app).
            
            var saveInputState = function() {
                if (hasLocalStorage()) {
                    inputs.forEach(function(i) {
                        if (i.hasChanged()) {
                            if (typeof(i.value()) === "undefined") {
                                localStorate.removeItem(i.id());
                            } else {
                                localStorage.setItem(i.id(), i.value());
                            }
                        }
                    })
                }
            };
            
            // #### restoreInputState()
            
            // Restore previously saved input state (if it's available in
            // local storage).
            
            var restoreInputState = function() {
                inputs.forEach(function(i) {
                    if (localStorage.getItem(i.id()) !== null) {
                        i.value(localStorage.getItem(i.id()));
                    }
                })
            }
            
            // #### setTabPanel()
            
            // Make a specific tab panel active. The input parameter
            // is a string that corresponds to the href hash for
            // the desired panel.
            
            var setTabPanel = function(panel) {

                    // Note that this panel has now been viewed by the user. (Well,
                    // it will have been viewed once we finish this handler.)
                    panelViewed(panel);
                    
                    // Simulate the effect of selecting the corresponding tab panel
                    // using the tabs themselves. Essentially that's nothing
                    // more than managing the `is-active` class on the tabs
                    // and the panels. The MDL style transitions take care
                    // of the rest.
                    
                    // First we remove the `is-active` class from all the tabs 
                    // and panels.
                    [].slice.call(document.querySelectorAll(".mdl-layout__tab-bar a")).
                        forEach(function(anchor) {
                            anchor.classList.remove("is-active");
                        }
                    );
                    [].slice.call(document.querySelectorAll(".mdl-layout__tab-panel")).
                        forEach(function(section) {
                            section.classList.remove("is-active");
                        }
                    );
                    
                    // Now we add the `is-active` class back to the targeted tab
                    // and panel.
                    document.querySelector(".mdl-layout__tab-bar a[href='#" + panel + "']").
                        classList.add("is-active");
                    document.getElementById(panel).classList.add("is-active");
                    
                    // Also, go ahead and position the window at the top
                    // of the new panel. If we don't take this action, some
                    // browsers leave the scroll position as-is (i.e. as it
                    // was in the old tab panel). That is not good.
                    document.getElementsByTagName('main')[0].scrollTop = 0;
            };
            
            // ### Components
            
            // #### Info
            
            // The Info object encapsulates the behavior
            // of an input element that accepts user input.
            
            function Info(el) {

                // ##### Private Properties and Attributes
    
                var element,                // Containing element for the info component
                    input,                  // Actual input control
                    required = false,       // Is input required?
                    hasChanged = false,     // Has the user changed the input?
                    validateOnBlur = false, // Force validation on blur?
                    callback;               // Callback for value changes

                // ##### Private Methods and Functions
                
                var setElement = function(el) {
                    
                    // Keep a reference to the various elements and sub-elements
                    element = el,
                    input = element.getElementsByTagName("input")[0];
                    
                    // Set/update event handlers
                    input.addEventListener("change", handleChange);
                    input.addEventListener("blur", handleBlur);

                };
                
                // ##### Event Handlers
                
                var handleChange = function(ev) {
                    hasChanged = true;
                    if (typeof callback === "function") {
                        callback(ev);
                    }
                };
                
                var handleBlur = function(ev) {

                    // We don't use `required` attributes initially
                    // to avoid a bunch of error messages on an
                    // empty form. But we will add the attribute
                    // after the user visits the input.
                    if (required) {
                        exports.markRequired();
                    }
                    if (validateOnBlur) {
                        exports.checkValidity();
                    }

                };

                // ##### Object to be Returned

                function exports() { };

                // ##### Public API Methods

                exports.callback = function(fn) {
                    if (!arguments.length) { return callback; }
                    callback = fn;
                    return this;
                };
                                            
                exports.checkValidity = function() {
                    return element.MaterialTextfield.checkValidity();
                };
                
                exports.hasChanged = function() {
                    return hasChanged;
                };
                
                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };
                
                exports.id = function(s) {
                    if (!arguments.length) { return input.getAttribute("id"); }
                    input.setAttribute("id", s);
                    return this;
                };
                
                exports.markRequired = function() {
                    input.setAttribute("required", "required");  
                };
                
                exports.required = function(b) {
                    if (!arguments.length) { return required; }
                    required = b;
                    return this;
                };
                
                exports.validateOnBlur = function(b) {
                    if (!arguments.length) { return validateOnBlur; }
                    validateOnBlur = b;
                    return this;
                };
                
                exports.value = function(x) {
                    if (!arguments.length) {
                        if (input && input.value) { 
                            return parseFloat(input.value); 
                        }
                        return undefined;
                    }
                    if (element) { 
                        element.MaterialTextfield.change(x);
                        handleChange();
                    }
                    return this;
                };

                // ##### Initialization

                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            };
            
            // #### Rating

            // The Rating object encapuslates the behavior of a
            // rating component on the page. The optional input
            // parameter of the constructor is the parent HTML
            // element.

            function Rating(el) {            

                // ##### Private Properties and Attributes
    
                var element,             // Containing element for the rating component
                    input,               // Actual input control
                    lowIcon,             // Icon for low value
                    highIcon,            // Icon for high value
                    keys,                // Key values
                    colorMin = false,    // Preserve color on minimum value?
                    hasChanged = false,  // Has the user changed the input?
                    callback;            // Callback for value changes

                // ##### Private Methods and Functions
                
                var setElement = function(el) {
                    
                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    input = element.getElementsByTagName("input")[0];
                    lowIcon = element.getElementsByTagName("i")[0];
                    highIcon = element.getElementsByTagName("i")[1];
                    keys = [].slice.call(element.getElementsByClassName("rating--key"));
                    
                    // Set/update event handlers
                    input.addEventListener("input", handleInput);
                    input.addEventListener("change", handleChange);

                };
                
                var update = function() {
                    // Cache the current value
                    var value = parseFloat(input.value);
                    
                    // Update the icons
                    lowIcon.style.opacity = value < 6 ? 1 : 0.25 + ((10 - value)/6);
                    highIcon.style.opacity = value > 4 ? 1 : 0.25 + (value/6);                        

                    // Update the keys
                    keys.forEach(function(key, idx) {
                        idx = 20/8 * idx;
                        if (Math.abs(value - idx) < 2) {
                            key.style.opacity = (2 - Math.abs(value - idx)) / 2;
                        } else {
                            key.style.opacity = 0;
                        }
                    })
                };

                // ##### Event Handlers
                
                var handleInput = function(ev) {
                    if (colorMin) {
                        // We don't want special styling on lowest value
                        setTimeout(function() {
                            input.classList.remove("is-lowest-value");
                        }, 0);
                    }
                    update();
                }

                var handleChange = function(ev) {

                    hasChanged = true;

                    // IE10 doesn't fire input events, so fire one for it
                    handleInput(ev);
                    
                    if (typeof callback === "function") {
                        callback(ev);
                    }

                }

                // ##### Object to be Returned

                function exports() { };

                // ##### Public API Methods

                exports.callback = function(fn) {
                    if (!arguments.length) { return callback; }
                    callback = fn;
                    return this;
                };
                                            
                exports.hasChanged = function() {
                    return hasChanged;
                };
                
                exports.colorMin = function(b) {
                    if (!arguments.length) { return colorMin; }
                    colorMin = b;
                    return this;
                };

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };
                
                exports.id = function(s) {
                    if (!arguments.length) { return input.getAttribute("id"); }
                    input.setAttribute("id", s);
                    return this;
                };
                
                exports.required = function() {
                    // Ratings are always (effectively) required
                    return true;
                };
                
                exports.value = function(x) {
                    if (!arguments.length) {
                        if (input && input.value) { 
                            return parseFloat(input.value); 
                        }
                        return undefined;
                    }
                    if (input) { 
                        input.MaterialSlider.change(x);
                        handleChange();
                    }
                    return this;
                };

                // ##### Initialization

                if (arguments.length) {
                    setElement(el);
                    update();
                }

                return exports;

            };
            
            // #### Gauge
            
            // The Gauge object encapsulates the behavior
            // of simple gauge. Most of the implementation
            // is in the CSS rules, but we do have a bit
            // of JavaScript to set or read the gauge value
            
            function Gauge(el) {

                // ##### Private Properties and Attributes
    
                var element,      // Containing element for the info component
                    data,         // `.gauge--data` element
                    needle,       // `.gauge--needle` element
                    value = 0.0,  // Current gauge value from 0 to 1
                    prop;         // Style for transform

                // ##### Private Methods and Functions
                
                var setElement = function(el) {
                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    data = element.querySelector(".gauge--data");
                    needle = element.querySelector(".gauge--needle");
                };
                
                var setValue = function(x) {
                    value = x;
                    data.style[prop] = "rotate(" + (x * 0.5) + "turn)";
                    needle.style[prop] = "rotate(" + (-0.5 + (x * 0.5)) + "turn)";
                };

                // ##### Object to be Returned

                function exports() { };

                // ##### Public API Methods

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };
                
                exports.value = function(x) {
                    if (!arguments.length) { return value; }
                    setValue(x);
                    return this;
                };

                // ##### Initialization
                
                var body = document.getElementsByTagName("body")[0];
                ["webkitTransform", "mozTransform", "msTransform", "oTransform", "transform"].
                    forEach(function(p) {
                        if (typeof body.style[p] !== "undefined") { prop = p; }
                    }
                );

                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            };

            // #### Bar
            
            // The Bar object encapsulates the behavior of a
            // simple, single bar. Most of the implementation
            // is in the CSS rules, but we do have a bit
            // of JavaScript to set or read the bar value
            
            function Bar(el) {

                // ##### Private Properties and Attributes
    
                var element,           // Containing element for the info component
                    data,              // `.bar--data` element
                    text,              // `.bar--text` element
                    value = 0.0,       // Current bar value from 0 to 1
                    confidence = 0.0;  // Confidence interval for value (0-1)

                // ##### Private Methods and Functions
                
                var getTextValue = function() {
                    if (value >= 0.10) {
                        return Math.round(value * 100) + "%";
                    } else if (value >= 0.01) {
                        return (Math.round(value * 1000) / 10) + "%";
                    } else {
                        return (Math.round(value * 10000) / 100) + "%";
                    }
                };

                var updateBar = function() {
                    text.textContent = getTextValue();
                    data.style.width = (value * 100) + "%";
                    text.style.left = "calc(" + (value * 100) + "% - " + 
                        (text.offsetWidth/2 - 2) + "px)";
                };

                var setElement = function(el) {
                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    data = element.querySelector(".bar--data");
                    text = element.querySelector(".bar--text");
                };
                
                var setValue = function(x) {
                    value = x;
                    updateBar();
                };
                    
                var setConfidence = function(x) {
                    confidence = x;
                    updateBar();
                };
                    
                // ##### Object to be Returned

                function exports() { };

                // ##### Public API Methods

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };
                
                exports.id = function(s) {
                    if (!arguments.length) { return el.getAttribute("id"); }
                    el.setAttribute("id", s);
                    return this;
                };
                
                exports.update = function() {
                    updateBar();
                    return this;
                };
                
                exports.value = function(x) {
                    if (!arguments.length) { return value; }
                    setValue(x);
                    return this;
                };

                exports.confidence = function(x) {
                    if (!arguments.length) { return confidence; }
                    setConfidence(x);
                    return this;
                };

                // ##### Initialization
                
                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            };

            // ### High Level Event Handlers
            
            // #### inputChanged()
            
            // The user has changed an input's value.
 
            var inputChanged = function(ev) {

                // Note the fact that the user has changed an input.                
                hasInputChanged = true;

                // Whenever the user updates an input, we save the new
                // state (in local storage) and update the visibility
                // of content as appropriate.
                saveInputState();
                evaluateInputs();
                calculateResults();
                updateResults();
                updateContentVisibility();
            };
            
            // #### panelViewed()
            
            // The user has viewed a panel in the tab navigation of the
            // app. The input paramter is a string with the hashtag value
            // of the viewed panel.
            
            var panelViewed = function(panel) {
                
                // There are two specific panels that we want to watch
                // for. Both are panels that show analysis results.
                if (panel === "advice" || panel === "details") {

                    // If the user is now viewing one of the results panels, note the fact.
                    hasVisitedResults = true;
                    
                    // And if the user has changed at least one input, we can enable
                    // validation so that missing values are highlighted. We only do
                    // this if the user has changed an input in case she is just
                    // checking out the various panels.
                    if (hasInputChanged) {
                        infos.forEach(function(info) {
                            if (info.required()) {
                                info.markRequired();
                                info.checkValidity();
                            }
                        });
                    }
                    
                }
                
                // If the new panel is the details panel, we need to update
                // the bar values. If the text position of the values was set
                // while the panel was hidden, it may be incorrect because the
                // size of the text label wasn't accurately known.
                if (panel === "details") {
                    for (bar in barVars) {
                        barVars[bar].update();
                    }
                }

            };
            
            // ### Initialization
            
            // Start initialization once the window is loaded.

            window.addEventListener('load', function() { 
            
                // #### Behavior Initialization
            
                // ##### Buttons and Anchor tags that Change Tab Panels
                            
                // Look for all the `<button>` and `<a> elements that have a `data-onclick`
                // attribute (that will indicate a new section). Those are buttons and links
                // that (are intended to) take the user to a different tab panel. Since MDL
                // doesn't have support for handling this function, we create our own event
                // handler forthem and force a change of panel.
                
                [].slice.call(document.querySelectorAll("button[data-onclick], a[data-onclick]")).
                    forEach(function(el) {
                        el.addEventListener("click", function(ev) {
                            
                            // Don't process links, etc.
                            ev.preventDefault();
    
                            // What panel is the user navigating to?
                            var target = el.getAttribute("data-onclick");
                            
                            // Make the desired panel active.
                            setTabPanel(target);
    
                        });
                    }
                );
                
                // ##### Hook Changes to Active Tab Panel
                
                // We need to spy on changes to the active tab panel in order to 
                // update the page intelligently.
    
                [].slice.call(document.getElementsByClassName("mdl-layout__tab")).
                    forEach(function(el) {
                        var target = el.getAttribute("href");
                        el.addEventListener("click", function(){
                            panelViewed(target.substring(1));
                        });
                    }
                );
                
                // #### Component Initialization
                
                // Unlike traditional JavaScript MV* frameworks/libraries, we
                // don't rely on templates to dynamically render content. Instead
                // we "pre-render" the content by creating it within the static
                // markup. This approach, in effect, is the same as server-side
                // rendering for the initial state, and it make the page render
                // significantly faster.
                
                // ##### Initialize Info Components
    
                [].slice.call(document.getElementsByClassName("info")).forEach(function(el) {
                    
                    // Note that all Info components are required.
                    var obj = new Info(el).required(true);
                    
                    // Now that we have an Info component, add it to the application
                    // state as appropriate. It's both a generic input (so it goes
                    // in the `inputVars` object and the `inputs` array), and a
                    // specific Info object.
                    inputVars[obj.id()] = obj;
                    inputs.push(obj);
                    infos.push(obj);
                    
                    // Register our event handler if the user changes the input.
                    obj.callback(inputChanged);
                });
                
                // ##### Initialize Rating Components
    
                [].slice.call(document.getElementsByClassName("rating")).
                    forEach(function(el) {
                        var obj = new Rating(el);
        
                        // Now that we have a Rating component, add it to the application
                        // state as appropriate. It's both a generic input (so it goes
                        // in the `inputVars` object and the `inputs` array), and a
                        // specific Rating object.
                        inputVars[obj.id()] = obj;
                        inputs.push(obj);
                        ratings.push(obj);
        
                        // Register our event handler if the user changes the input.
                        obj.callback(inputChanged);
                    }
                );
                
                // ##### Initialize Result Gauge Component
                
                resultGauge = new Gauge(document.getElementById("gaugeResult"));
                
                // ##### Initialize Bar Components
    
                [].slice.call(document.getElementsByClassName("bar")).
                    forEach(function(el) {
                        var obj = new Bar(el);
        
                        // Now that we have a Bar component, add it to the application
                        // state as appropriate.
                        barVars[obj.id()] = obj;
                    }
                );

                // #### Restore Input State
                
                // We defer execution of the actual restore code
                // until the stack has unwound. That avoids any
                // race condition between this function and the
                // initialization of the input components. Once the
                // values are restored, we can evaluate them and
                // update the app as appropriate.
                setTimeout(function() {
                    restoreInputState();
                    evaluateInputs();
                    calculateResults();
                    updateResults();
                    updateContentVisibility();

                }, 0);
                
            });

        </script>

    </body>
</html>
