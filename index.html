<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <!--

        # Amniocentesis Advisor
        ==========================================================================================

        Copyright (c) 2015 by Stephen Thomas.
        Open sourced under [MIT License](http://opensource.org/licenses/MIT).

        This is a single-page web application that offers advice on amniocentesis testing
        for expectant mothers and families. The application relies on decision theory
        [need reference] to help patients make a more informed choice that balances the
        risks and benefits of the procedure against their personal priorities.

        Currently the application is implemented completely within a single `index.html`
        file. This optimizes performance, especially over mobile networks, by minimizing
        the number of network requests. As the app gets more complex, however, it will
        likely be broken up into (at least) separate HTML, CSS, and JavaScript files. It may
        also be beneficial to minimize the content (including removing comments).

        Note that the application does not use any templating for constructing the markup.
        This approach is also chosen to optimize performance, in this case to minimize time
        to full render.

        -->

        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Amniocentesis Advisor</title>
        <meta name="description"
              content="Web application that advises patients on amniocentesis testing">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">

        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Amnio Advisor">

        <!-- Icons -->
        <link rel="shortcut icon" href="favicon.ico" />
        <link rel="icon" type="image/x-icon" sizes="16x16 32x32" href="favicon.ico">
        <link rel="apple-touch-icon" sizes="152x152" href="favicon-152.png">
        <link rel="apple-touch-icon" sizes="144x144" href="favicon-144.png">
        <link rel="apple-touch-icon" sizes="120x120" href="favicon-120.png">
        <link rel="apple-touch-icon" sizes="114x114" href="favicon-114.png">
        <link rel="apple-touch-icon" sizes="180x180" href="favicon-180.png">
        <link rel="apple-touch-icon" sizes="72x72" href="favicon-72.png">
        <link rel="apple-touch-icon" href="favicon-57.png">
        <link rel="icon" href="favicon-32.png" sizes="32x32">
        <link rel="icon" sizes="192x192" href="favicon-192.png">
        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-TileImage" content="favicon-144.png">

        <!--

        ## Styles
        --------------------------------------------------------------------------------------

        Most of the styles rely on standard Material Design Lite (MDL) stylesheets delivered
        from Google's CDN; however, we do have some local style definitions and we need to
        override a few of the MDL defaults.

        First we include the standard MDL font (Roboto) and the icon font. Those are followed
        by a themed MDL stylesheet. Note that the Roboto font may be commented out and the
        application will fall back to Helvetica on all devices except Andriod. This saves
        a network request and about 1.3 MBytes (uncompressed) of download data.

        > Note: If the MDL style sheet is updated to a new version, the corresponding
          script (see below) probably also needs updating.

        After the included style sheets we define our own local styles.

        -->

        <!--
        <link rel="stylesheet" type="text/css"
              href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
        -->
        <link rel="stylesheet" type="text/css"
              href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" type="text/css"
              href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.indigo-pink.min.css">

        <style>

            /*
             * ### Generic Styles
             */

            /*
             * Tweak the display of `<legend>` elements, which we
             * use as "super-labels" for fieldsets.
             */

            legend {
                display: table; /* needed to force IE to word-wrap */
                padding-top: 1em;
            }

            /*
             * Get rid of the spinners on number inputs.
             */

            input[type=number]::-webkit-inner-spin-button,
            input[type=number]::-webkit-outer-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            input[type=number] {
                -moz-appearance:textfield;
            }

            /*
             * ### MDL Adjustments
             */

            /*
             * Limit the width of the tab bar to match the card.
             */

            .mdl-layout__tab-bar-container {
                background-color: rgb(48,63,159);
            }

            nav {
                max-width: 616px;
            }

            /*
             * Style icons used to note content.
             */

            i.icon__note {
                color: #E91E63;
            }

            /*
             * Adjust the margins and padding because all the content
             * appears in cards,
             */

            .mdl-card {
                min-height: 100px;
                margin: 16px;
                max-width: 600px;
                width: auto;
            }

            .mdl_card__supporting-text__note {
                padding: 0 8px;
            }

            .mdl-card__supporting-text fieldset p {
                width: calc(100% - 32px);
            }

            /*
             * Correct some problems with validation error messages
             * on desktop Safari.
             */

            .mdl-textfield--floating-label.is-invalid .mdl-textfield__label {
                top: 4px;
            }

            .mdl-textfield__error {
                left: 0;
                top: 48px;
            }

            .info {
                margin-bottom: 5px;
            }

            /*
             * ### Custom Components
             */

            /*
             * #### Progress Component
             */

            .progress .mdl-spinner {
                display: block;
                margin: 0 auto;
            }

            /*
             * #### Rating Component
             */

            /*
             * The `rating` component is an enhanced version of the
             * material design slider with several additional features.
             * For details on the component, refer to the JavaScript
             * code below. The unique styles for the component follow.
             */

            fieldset div.rating {
                padding-top: 0.5em;
            }

            fieldset div.rating:last-child {
                padding-bottom: 2.2em;
            }

            .rating {
                width: 108%;
            }

            .rating > label {
                display: block;
                line-height: 1.5;
                padding-left: 8px;
                padding-top: 1em;
                width: calc(100% - 32px);
            }

            .rating .mdl-slider__container,
            .rating .mdl-slider__ie-container {
                float: left;
                top: 6px;
                width: calc(100% - 72px);
            }

            .rating .mdl-slider__ie-container {
                position: relative;
            }

            .rating .mdl-slider__container .mdl-slider__background-flex {
                -webkit-transform: translate(0,3px);
                    -ms-transform: translate(0,3px);
                        transform: translate(0,3px);
            }

            .rating > i {
                float: left;
                position: relative;
                top: 8px;
            }

            .rating > i:first-of-type {
                left: 8px;
            }

            .rating input[type=range] {
                position: absolute;
                top: 13px;
            }

            .rating .mdl-slider__ie-container input[type=range] {
                top: -2px;
                width: 100%;
            }

            .rating > i:last-of-type {
                right: 8px;
            }

            .rating--keys {
                display: table;
                position: relative;
                left: calc(36px - 16px);
                top: 6px;
                width: calc(100% + 16px - 72px);
            }

            .rating .mdl-slider__ie-container .rating--keys {
                left: 16px;
            }

            .rating--key {
                display: table-cell;
                opacity: 0;
                text-align: center;
                width: 20%;
            }

            /*
             * #### Gauge Component
             *
             * The standard markup for the component is:
             *
             *      <div class="gauge">
             *          <div class="gauge--container">
             *              <div class="gauge--marker"></div>
             *              <div class="gauge--background"></div>
             *              <div class="gauge--center"></div>
             *              <div class="gauge--data"></div>
             *              <div class="gauge--needle"></div>
             *          </div>
             *          <div class="gauge--labels">
             *              <span class="gauge--label__low">No</span>
             *              <span class="gauge--label__spacer"></span>
             *              <span class="gauge--label__high">Yes</span>
             *          </div>
             *      </div>
             */

            /*
             * First define all of the relevant rules that aren't dependent
             * on the size of the gauge. We want to collect the size-depenent
             * rules in one place to make it easier to adjust the size.
             */

            .gauge {
                position: relative;
				background-color: white;
            }

            .gauge--container {
            	margin: 0 auto;
            	padding: 0;
            	position: relative;
            	overflow: hidden;
            	text-align: center;
            }

            .gauge--background {
            	z-index: 0;
            	position: absolute;
            	background-color: #C5CAE9;
            	top: 0;
            	border-radius: 300px 300px 0 0;
            }

            .gauge--data {
            	z-index: 1;
            	position: absolute;
            	background-color: #3F51B5;
            	margin-left: auto;
            	margin-right: auto;
            	border-radius: 300px 300px 0 0;
                -webkit-transform-origin: center bottom;
                   -moz-transform-origin: center bottom;
                    -ms-transform-origin: center bottom;
                     -o-transform-origin: center bottom;
                        transform-origin: center bottom;
            }

            .gauge--center {
            	z-index: 3;
            	position: absolute;
            	background-color: #fff;
            	margin-right: auto;
            	border-radius: 300px 300px 0 0;
            }

            .gauge--marker {
                z-index: 4;
                background-color: #fff;
                position: absolute;
                width: 1px;
            }

            .gauge--needle {
                z-index: 5;
                background-color: #E91E63;
                height: 3px;
                position: absolute;
                -webkit-transform-origin: left center;
                   -moz-transform-origin: left center;
                    -ms-transform-origin: left center;
                     -o-transform-origin: left center;
                        transform-origin: left center;
            }

            .gauge--labels {
                display: table;
                margin: 0 auto;
                position: relative;
            }

            .gauge--label__low {
                display: table-cell;
                text-align: center;
            }

            .gauge--label__spacer {
                display: table-cell;
            }

            .gauge--label__high {
                display: table-cell;
                text-align: center;
            }

            /*
             * Now define the rules that depend on the size of
             * the gauge. We start with sizing for a small mobile
             * device.
             */

            .gauge { height: calc(120px + 3em); }
            .gauge--container { width: 240px; height: 120px; }
            .gauge--marker { height: 120px; left: 119.5px; }
            .gauge--background { width: 240px; height: 120px; }
            .gauge--center { width: 144px; height: 72px; top: 48px; margin-left: 48px; }
            .gauge--data { width: 240px; height: 120px; }
            .gauge--needle { left: 120px; top: 117px; width: 120px; }
            .gauge--labels { width: 240px; }
            .gauge--label__low { width: 48px; }
            .gauge--label__spacer { width: 144px; }
            .gauge--label__high { width: 48px; }

            /*
             * Increase the gauge size slightly on larger viewports.
             */

             @media only screen and (min-width: 400px) {
                .gauge { height: calc(150px + 3em); }
                .gauge--container { width: 300px; height: 150px; }
                .gauge--marker { height: 150px; left: 149.5px; }
                .gauge--background { width: 300px; height: 150px; }
                .gauge--center { width: 180px; height: 90px; top: 60px; margin-left: 60px; }
                .gauge--data { width: 300px; height: 150px; }
                .gauge--needle { left: 150px; top: 147px; width: 150px; }
                .gauge--labels { width: 300px; }
                .gauge--label__low { width: 60px; }
                .gauge--label__spacer { width: 180px; }
                .gauge--label__high { width: 60px; }
            }

            /*
             * As an option, the `gauge__liveupdate` class can be added
             * to the main gauge element. When this class is present,
             * we add a transition that animates any changes to the gauge
             * value. Currently, the app does not use this option because
             * all the inputs that can change gauge values are present
             * on tab panels that are different from the gauge itself.
             * Therefore, users won't be able to see any gauge changes
             * when they make input changes. The code is available, though,
             * should this change.
             */

            .gauge__liveupdate .gauge--data,
            .gauge__liveupdate .gauge--needle {
                -webkit-transition: all 1.5s ease-in-out;
                   -moz-transition: all 1.5s ease-in-out;
                    -ms-transition: all 1.5s ease-in-out;
                     -o-transition: all 1.5s ease-in-out;
                        transition: all 1.5s ease-in-out;
            }

            /*
             * For a given gauge value, x, ranging from 0.0 to 1.0, set
             * the `transform: rotate()` property according to the
             * following equation: `-0.5 + 0.5x turns` The default
             * properties below represent an x value of 0.
             */

            .gauge--data {
                -webkit-transform: rotate(-.50turn);
                   -moz-transform: rotate(-.50turn);
                    -ms-transform: rotate(-.50turn);
                     -o-transform: rotate(-.50turn);
                        transform: rotate(-.50turn);
            }
            .gauge--needle {
                -webkit-transform: rotate(-.50turn);
                   -moz-transform: rotate(-.50turn);
                    -ms-transform: rotate(-.50turn);
                     -o-transform: rotate(-.50turn);
                        transform: rotate(-.50turn);
            }

            /*
             * #### Bar Component
             */

            .bar {
                position: relative;
                left: 8px;
                height: calc(2em + 16px);
                width: calc(100% - 16px);
             }

            .bar--background {
                background-color: #C5CAE9;
                height: 16px;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
             }

            .bar--data {
                background-color: #3F51B5;
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 0%;
                z-index: 1;
            }

            .bar--range {
                position: absolute;
                border-right: 1px solid #E91E63;
                border-left: 1px solid #E91E63;
                border-bottom: 1px solid #E91E63;
                top: calc(100% + 2px);
                left: 0;
                height: 2px;
                width: 0%;
                z-index: 2;
            }

            .bar--needle {
                background-color: #E91E63;
                position: absolute;
                top: -2px;
                left: 0;
                height: calc(100% + 4px);
                width: 3px;
                z-index: 3;
            }

            .bar--text {
                display: inline-block;
                position: absolute;
                top: 20px;
                left: calc(0% - 8.5px);
            }

            /*
             * #### Results Table Component
             */

            /*
             * Minor tweaks to a standard MDL `<table>` that's
             * used to present detailed results of the analysis.
             */

            .results-table {
                margin: 0 8px;
            }

			.mdl-data-table td:first-of-type, .mdl-data-table th:first-of-type {
			    padding-left: 18px
			}

			.mdl-data-table td:last-of-type, .mdl-data-table th:last-of-type {
			    padding-right: 18px
			}

			.mdl-data-table td {
			    padding: 12px 12px 0;
			}

            .mdl-data-table td.results-table--name {
                padding-bottom: 6px;
                vertical-align: bottom;
            }

            /*
             * ### Content Visibility
             *
             * Show/hide content based on the application state. There are several
             * classes that determine main content visibility:
             *
             * - `results__notready`: Content within a container with this
             *    class is visible when the results are not ready. The content
             *    is generally a prompt for the user to provide the information
             *    needed to generate results.
             * - `results__ready`: Content within a container with this class
             *    is visible when the analysis is complete.
             * - `results__in-progress`: Content within a container with this
             *    class is visibile when computation is in progress.
             *
             * Initially, only the `results__notready` content is visible. To change
             * the content visibility, JavaScript code adds appropriate `data-`
             * attributes to the `<body>` element. (We use `data-` attributes
             * instead of classes so that it's clear when a style is affected
             * by JavaScript code. JavaScript only sets `data-` attributes; and
             * only JavaScript sets `data-` attributes.)
             *
             * - `data-results`: set to `"true"` when results are available.
             * - `data-computing`: set to the number of computations pending.
             *
             * For completeness, we also support `data-results-notready` but its
             * use is discouraged.
             *
             * There are also distinct classes to mark content based on whether
             * or not an amniocentesis is advisable. Those classes are:
             *
             * - `amnio-false` if amniocentesis is not advised, and
             * - `amnio-true` if amniocentesis is advised.
             *
             * Initially, both content types are hidden. The appropriate content
             * can be revealed by setting the `data-amnio` attribute on the
             * `<body>` tag to be "true" or "false".
             *
             * There are also classes to refine the content based on the lab test
             * input that is provided.
             *
             * - `lab-first` if only first trimester input is available
             * - `lab-second` if only second trimester input is available
             * - `lab-both` if lab input is available for both trimesters
             *
             * The `data-lab` attribute controls that content. Its values are
             * "first", "second", or "both".
             *
             * There are a couple of classes that reveal content suggesting
             * the user complete input for lab test results:
             *
             * - `lab-partial__first` if only partial information has been
             *   provided for first trimester lab tests
             * - `lab-partial__second` if only partial information has been
             *   provided for first trimester lab tests
             *
             * The `data-lab-partial` controls the visibility of that content,
             * with values of "first" or "second" respectively.
             *
             * The `priorities__limited` class indicates that results are based
             * on limited priority values. Content within a container with this
             * class is visible when analysis results are available but could be
             * improved with better priority input. The content is generally a
             * suggestion to the user for improving the input. The attribute that
             * controls this content is `data-priorities-limited` and it takes
             * values of "true" or "false".
             */

            .results__notready {
                display: none;
            }

            .results__ready {
                display: none;
            }

            body[data-computing="0"][data-results-ready="true"] .results__notready {
                display: none;
            }

            body[data-computing="0"][data-results-ready="true"] .results__ready {
                display: block;
            }

            body[data-computing="0"][data-results-ready="false"] .results__notready {
                display: block;
            }

            body[data-computing="0"][data-results-ready="false"] .results__ready {
                display: none;
            }

            body[data-computing] .results__in-progress {
                display: block;
            }

            body[data-computing="0"] .results__in-progress {
                display: none;
            }

            .amnio-false, .amnio-true {
                display: none;
            }

            body[data-amnio="true"] .amnio-true {
                display: block;
            }

            body[data-amnio="true"] span.amnio-true {
                display: inline;
            }

            body[data-amnio="false"] .amnio-false {
                display: block;
            }

            body[data-amnio="false"] span.amnio-false {
                display: inline;
            }

            .lab-first, .lab-second, .lab-both {
                display: none;
            }

            body[data-lab="first"] .lab-first {
                display: block;
            }

            body[data-lab="first"] span.lab-first {
                display: inline;
            }

            body[data-lab="second"] .lab-second {
                display: block;
            }

            body[data-lab="second"] span.lab-second {
                display: inline;
            }

            body[data-lab="both"] .lab-both {
                display: block;
            }

            body[data-lab="both"] span.lab-both {
                display: inline;
            }

            .lab-partial__first {
                display: none;
            }

            body[data-lab-partial="first"] .lab-partial__first {
                display: block;
            }

            body[data-lab-partial="first"] span.lab-partial__first {
                display: inline;
            }

            .lab-partial__second {
                display: none;
            }

            body[data-lab-partial="second"] .lab-partial__second {
                display: block;
            }

            body[data-lab-partial="second"] span.lab-partial__second {
                display: inline;
            }

            .priorities__limited {
                display: none;
            }

            body[data-priorities-limited="true"] .priorities__limited {
                display: block;
            }

            body[data-priorities-limited="true"] span.priorities__limited {
                display: inline;
            }

        </style>

    </head>

    <!--

    ## Markup (HTML)
    ------------------------------------------------------------------------------------------

    Not too much to say about the markup at a high level. It's pretty much standard
    Material Design Lite. We are currently using the `-force-preferred-font` suffix
    for typography classes to ensure that a consistent font is used throughout the
    application. That may change if we get around to implementing conditional font-face
    application based on available system fonts (which is ideal, but a lot of work).

    -->

    <body class="mdl-color--grey-100 mdl-color-text--grey-700 mdl-base" data-computing="0">

        <!--

        ### IE8 (and Older) Fallback

        Hopefully we don't have to worry about IE8 any more, but just in
        case, we use conditional comments to detect it. If we do find
        IE8, add a note suggesting that the user upgrade the browser.
        We don't bother to spend any time formatting the note, etc.

        -->

        <!--[if lt IE 9]>
            <p class="browserupgrade">
                You are using an <strong>outdated</strong> browser. Please
                <a href='http://browsehappy.com/'>upgrade your browser</a>
                to improve your experience.
            </p>
        <![endif]-->

        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs">

            <!--

            ### Application Navigation Header

            Although MDL generally uses tabs as a component within a page, we're using
            it for the overall application structure. For accessibility, we use semantic
            elements instead of generic `<div>` tags.

            -->

            <header class="mdl-layout__header mdl-color--primary">
                <nav class="mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark
                            mdl-typography--body-2-force-preferred-font">
                    <a href="#welcome" class="mdl-layout__tab is-active">Welcome</a>
                    <a href="#info" class="mdl-layout__tab">Info</a>
                    <a href="#priorities" class="mdl-layout__tab">Priorities</a>
                    <a href="#advice" class="mdl-layout__tab">Advice</a>
                    <a href="#details" class="mdl-layout__tab">Details</a>
                </nav>
            </header>

            <main class="mdl-layout__content">

                <!--

                ### Welcome Panel

                The first tab panel is a general welcome screen. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel is-active" id="welcome">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Amniocentesis Advisor</h2>
                            </div>
							<div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
	                            <p>
	                                Welcome and introductory information here.
	                            </p>
	                            <p>
	                                <em>If you have stumbled across this application on the
	                                internet, please note that this is a non-functioning
	                                 prototype. It does <strong>not</strong> provide actual
	                                 advice.</em>
	                            </p>
	            				<p>
	                				For more information, you can visit the following web sites:
	                            </p>
	            				<ul>
	            					<li><a href="http://www.cdc.gov/ncbddd/birthdefects/features/key-findings-down-syndrome-prevalence.html">
	                					Prevalence of Down syndrome in the United States
	                				</a></li>
	            					<li><a href="http://www.cdc.gov/ncbddd/birthdefects/diagnosis.html">
	                					Diagnosis for birth defects
	                				</a></li>
	            					<li><a href="http://www.ndss.org/">
	                					National Down Syndrome Society
	                				</a></li>
	            					<li><a href="http://www.ndsccenter.org/">
	                					National Down Syndrome Congress
	                				</a></li>
	            					<li><a href="http://www.ds-int.org/">
	                					Down Syndrome International
	                				</a></li>
	            					<li><a href="http://www.nlm.nih.gov/medlineplus/downsyndrome.html">
	                					Medline
	                				</a></li>
	            					<li><a href="http://www.mayoclinic.org/diseases-conditions/down-syndrome/basics/definition/con-20020948">
	                					Mayo Clinic
	                				</a></li>
	            				</ul>
								<p>
	                                <em>Note:</em> Your information is completely private. We
	                                do not store or save any of your information on our
	                                 servers. Nor do we use any cookies.
	                            </p>
	                            <p>
	                                Get started by telling us some basic medical information.
	                            </p>
							</div>
							<div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary"
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Medical Information

                The next tab panel collects medical information. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="info">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Medical Information</h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    In addition to some general information, we need to know
                                    the results from lab tests performed during your first
                                    and second trimesters. If you have results from both
                                    trimesters, please enter them below. If you only have
                                    results for one trimester, just enter those values.
                                    Your doctor can help you find the right values.
                                </p>

                                <!--

                                Enclose the inputs within a `<form>` element so that we
                                can easily check validity of all inputs. See JavaScript
                                below for details.

                                -->

                                <form action="#">

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            General information:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input"
                                                   type="number" min="1" max="99" id="infoAge" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="age">
                                                How old are you?
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 1 and 99
                                            </span>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            First trimester lab test results:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number"
                                                min="0.5" max="2.5" step="any" id="infoNt" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="nt">
                                                Nuchal Translucency (NT)
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.5 and 2.5 (MoM)
                                            </span>
                                        </div>
                                        <div class="mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.2" max="3.0" step="any" id="infoPappa" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="pappa">
                                                PAPP-A
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.2 and 3.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="mdl-textfield
                                                    mdl-js-textfield mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.3" max="5.0" step="any" id="infoFbhcg" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="fbhcg">
                                                fbhCG
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.3 and 5.0 (MoM)
                                            </span>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            Second trimester lab test results:
                                        </legend>
                                        <div class="mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label info">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.4" max="3.0" step="any" id="infoAfp" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="apf">
                                                Alpha-Feprotein (AFP)
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 3.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield
                                                    mdl-js-textfield mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.4" max="2.0" step="any" id="infoUe3" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="ue3">
                                                Unconjugated Estriol (uE3)
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 2.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.3" max="5.0" step="any" id="infoInhibina" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="inhibina">
                                                Inhibin-A
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.3 and 5.0 (MoM)
                                            </span>
                                        </div>
                                        <div class="info mdl-textfield mdl-js-textfield
                                                    mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" type="number"
                                                   min="0.4" max="5.0" step="any" id="infoHcg" />
                                            <label class="mdl-textfield__label
                                                          mdl-typography--caption-force-preferred-font"
                                                   for="hcg">
                                                   Total hCG
                                            </label>
                                            <span class="mdl-textfield__error
                                                         mdl-typography--caption-force-preferred-font">
                                                Please enter a number between 0.4 and 5.0 (MoM)
                                            </span>
                                        </div>
                                    </fieldset>

                                </form>

                                <p>
                                    Next, help us understand your concerns and priorities.
                                </p>

                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--primary
                                               mdl-button--raised mdl-js-ripple-effect"
                                        data-onclick="priorities">
                                    Priorities
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__first">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    If you can enter the remaining information for
                                    first trimester lab tests, our advice will be
                                    more accurate.
                                </p>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__second">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    If you can enter the remaining information for
                                    second trimester lab tests, our advice will be
                                    more accurate.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Patient Priorities

                The next tab panel accepts patient priority data. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="priorities">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Your priorities</h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    To help us understand your priorities, please tell us how
                                    you feel about the following possible outcomes.
                                </p>

                                <!--

                                Enclose the inputs within a `<form>` element so that we
                                can easily check validity of all inputs. See JavaScript
                                below for details.

                                -->

                                <form action="#">

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you <strong>don't</strong> have an
                                            amniocentesis:
                                        </legend>
                                        <div class="rating">
                                            <label for="ratingNotestHealthy"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born healthy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingNotestHealthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="ratingNotestDs"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born with Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingNotestDs" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="ratingNotestStill"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby has Down Syndrome but is stillborn
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingNotestStill" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that shows
                                            <strong>no</strong> Down Syndrome:
                                        </legend>
                                        <div class="rating">
                                            <label for="ratingTestHealthy"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born healthy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingTestHealthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that shows
                                            Down Syndrome:
                                        </legend>
                                        <div class="rating">
                                            <label for="ratingTestTerm"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And you terminate the pregnancy
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingTestTerm" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="ratingTestDs"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is born with Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingTestDs" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="ratingTestStill"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby is stillborn
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingTestStill" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                   </fieldset>

                                    <fieldset>
                                        <legend class="mdl-typography--subhead">
                                            If you have an amniocentesis that results in
                                            a miscarriage:
                                        </legend>
                                        <div class="rating">
                                            <label for="ratingMisDs"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby had Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingMisDs" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                        <div class="rating">
                                            <label for="ratingMisHealthy"
                                                   class="mdl-typography--body-1-force-preferred-font">
                                                And the baby did <strong>not</strong> have
                                                Down Syndrome
                                            </label>
                                            <i class="material-icons">mood_bad</i>
                                            <input class="mdl-slider mdl-js-slider"
                                                   type="range" min="0" max="10" step="0.01"
                                                   value="5" tabindex="0" id="ratingMisHealthy" />
                                            <i class="material-icons">mood</i>
                                            <div class="rating--keys
                                                        mdl-typography--caption-force-preferred-font">
                                                <span class="rating--key">Very Sad</span>
                                                <span class="rating--key">Sad</span>
                                                <span class="rating--key">Okay</span>
                                                <span class="rating--key">Happy</span>
                                                <span class="rating--key">Very Happy</span>
                                            </div>
                                        </div>
                                   </fieldset>

                                </form>

                                <p>
                                    Based on your information and priorities, we can
                                    offer some advice on an amniocentesis.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary"
                                        data-onclick="advice">
                                    Advice
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp priorities__limited">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    We can give you better advice if you
                                    pick a wider range of values for your priorities.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>


                <!--

                ### Suggested Action

                The next tab panel shows the suggested action (at a high level). Like all
                panels, it is implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="advice">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp
                                    results__notready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Is Amniocentesis Recommended?
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    Before we can offer any suggestions, we need some
                                    basic medical information.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary"
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp
                                    results__in-progress">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Is Amniocentesis Recommended?
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    Please wait while we analyze your information...
                                </p>
                                <div class="progress">
                                    <div class="mdl-spinner mdl-js-spinner
                                                mdl-spinner--single-color is-active">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp results__ready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Is Amniocentesis Recommended?
                                </h2>
                            </div>
                        	<div class="mdl-card__media gauge" id="gaugeResult">
                            	<div class="gauge--container">
                            		<div class="gauge--marker"></div>
                            		<div class="gauge--background"></div>
                            		<div class="gauge--center"></div>
                            		<div class="gauge--data"></div>
                            		<div class="gauge--needle"></div>
                            	</div>
                            	<div class="gauge--labels mdl-typography--headline">
                                	<span class="gauge--label__low">No</span>
                                	<span class="gauge--label__spacer"></span>
                                	<span class="gauge--label__high">Yes</span>
                            	</div>
                        	</div>
                            <div class="mdl-typography--body-1-force-preferred-font
                                        mdl-card__supporting-text">
                                <p class="amnio-true">
                                    Based on your priorities and medical information,
                                    an amniocentesis will improve your chances of
                                    a more desirable outcome. We suggest that you have
                                    the procedure.
                                </p>
                                <p class="amnio-false">
                                    Based on your priorities and medical information,
                                    an amniocentesis will not improve your chances of
                                    a more desirable outcome. We suggest that you do
                                    <strong>not</strong> have the procedure.
                                </p>
                                <p>
                                    You can look at the details to understand how
                                    we came to this suggestion.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary"
                                        data-onclick="details">
                                    Details
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__first">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    It looks like you were able to enter
                                    some values for your first trimester lab results.
                                    If you can enter the remaining values, we can
                                    give you better advice. Would you like to
                                    update those values now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="info">
                                    Update Information
                                </a>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__second">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    It looks like you were able to enter
                                    some values for your second trimester lab results.
                                    If you can enter the remaining values, we can
                                    give you better advice. Would you like to
                                    update those values now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="info">
                                    Update Information
                                </a>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp priorities__limited">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    We can give you better advice if you
                                    pick a wider range of values for your priorities. Would
                                    you like to review them now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="priorities">
                                    Review Priorities
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!--

                ### Detailed Analysis

                The next tab panel provides details of the analysis. Like all panels, it is
                implemented as a MDL card.

                -->

                <section class="mdl-layout__tab-panel" id="details">
                    <div class="page-content">
                        <div class="mdl-card mdl-shadow--2dp
                                    results__notready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Detailed Analysis
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    Before we can give you a detailed analysis, we need some
                                    basic medical information.
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised
                                               mdl-js-ripple-effect mdl-button--primary"
                                        data-onclick="info">
                                    Medical Info
                                </button>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp
                                    results__in-progress">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Detailed Analysis
                                </h2>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <p>
                                    Please wait while we analyze your information...
                                </p>
                                <div class="progress">
                                    <div class="mdl-spinner mdl-js-spinner
                                                mdl-spinner--single-color is-active">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp results__ready">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">
                                    Detailed Analysis
                                </h2>
                            </div>
                            <div class="mdl-typography--body-1-force-preferred-font
                                        mdl-card__supporting-text mdl-card--border">
                                <p class="mdl_card__supporting-text__note">
                                    First we estimate the chance of a Down Syndrome
                                    pregnancy for an average woman of your age:
                                </p>
                                <div id="barBaseline" class="bar">
                                    <div class="bar--background">
                                        <div class="bar--data"></div>
                                        <div class="bar--range"></div>
                                        <div class="bar--needle"></div>
                                    </div>
                                    <span class="bar--text">0%</span>
                                </div>
                                <p class="mdl_card__supporting-text__note">
                                    Then we use the lab results to improve that estimate
                                    for this particular pregnancy. Based on your
                                    <span class="lab-first">first</span>
                                    <span class="lab-second">second</span>
                                    <span class="lab-both">first and second</span>
                                    trimester results, we expect the chance of Down
                                    Syndrome to be between <span id="risk-low"></span> and
                                    <span id="risk-high"></span>, and our best estimate
                                    is <span id="risk-mean"></span>.
                                </p>
                                <div id="barRisk" class="bar">
                                    <div class="bar--background">
                                        <div class="bar--data"></div>
                                        <div class="bar--range"></div>
                                        <div class="bar--needle"></div>
                                    </div>
                                    <span class="bar--text">0%</span>
                                </div>
                                <p class="mdl_card__supporting-text__note lab-first
                                          p__continued">
                                    <em>Note:</em>
                                    If you can give us results
                                    from second trimester lab tests, we can improve
                                    that estimate.
                                </p>
                                <p class="mdl_card__supporting-text__note lab-second
                                          p__continued">
                                    <em>Note:</em>
                                    If you can give us results
                                    from first trimester lab tests, we can improve
                                    that estimate.
                                </p>
                                <p class="mdl_card__supporting-text__note">
                                    We also estimate the chance that Down Syndrome
                                    results in a stillbirth:
                                </p>
                                <div id="barStill" class="bar">
                                    <div class="bar--background">
                                        <div class="bar--data"></div>
                                        <div class="bar--range"></div>
                                        <div class="bar--needle"></div>
                                    </div>
                                    <span class="bar--text">0%</span>
                                </div>
                                <p class="mdl_card__supporting-text__note">
                                    And we estimate the chance that an Amniocentesis
                                    results in a miscarriage:
                                </p>
                                <div id="barMis" class="bar">
                                    <div class="bar--background">
                                        <div class="bar--data"></div>
                                        <div class="bar--range"></div>
                                        <div class="bar--needle"></div>
                                    </div>
                                    <span class="bar--text">0%</span>
                                </div>
                                <p class="mdl_card__supporting-text__note">
                                    Using those estimates and the priorities you
                                    have provided, we calculate a score for
                                    <strong>not</strong> having an amniocentesis
                                    and a score for having an amniocentesis:
                                    <table class="mdl-data-table mdl-js-data-table
                                                  results-table">
                                        <tr>
                                            <td class="mdl-data-table__cell--non-numeric
                                                       results-table--name">
                                                <strong>No</strong> Amniocentesis:
                                            </td>
                                            <td class="mdl-typography--display-1
                                                       results-table--value"
                                                id="results-no-amnio">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="mdl-data-table__cell--non-numeric
                                                       results-table--name">
                                                Amniocentesis:
                                            </td>
                                            <td class="mdl-typography--display-1
                                                       results-table--value"
                                                id="results-amnio">
                                            </td>
                                        </tr>
                                    </table>
                                </p>
                                <p class="mdl_card__supporting-text__note">
                                    We suggest the choice with the highest score.
                                    Based on your scores, we
                                    <span class="amnio-false">do <strong>not</strong></span>
                                    recommend an Amniocentesis.
                                </p>
                                <p class="mdl_card__supporting-text__note">
                                    If you wish, you can adjust your priorities to see
                                    how they might change our advice.
                                </p>
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="priorities">
                                    Adjust Priorities
                                </a>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__first">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    It looks like you were able to enter
                                    some values for your first trimester lab results.
                                    If you can enter the remaining values, we can
                                    give you better advice. Would you like to
                                    update those values now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="info">
                                    Update Information
                                </a>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp lab-partial__second">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    It looks like you were able to enter
                                    some values for your second trimester lab results.
                                    If you can enter the remaining values, we can
                                    give you better advice. Would you like to
                                    update those values now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="info">
                                    Update Information
                                </a>
                            </div>
                        </div>
                        <div class="mdl-card mdl-shadow--2dp priorities__limited">
                            <div class="mdl-card__supporting-text mdl-typography--body-1-force-preferred-font">
                                <div>
                                    <i class="material-icons icon__note">announcement</i>
                                </div>
                                <p>
                                    We can give you better advice if you
                                    pick a wider range of values for your priorities. Would
                                    you like to review them now?
                                </p>
                            </div>
                            <div class="mdl-card__actions">
                                <a class="mdl-button mdl-button--colored mdl-js-button
                                          mdl-js-ripple-effect"
                                   data-onclick="priorities">
                                    Review Priorities
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!--

            ### Application Footer

            An optional application footer with links to, e.g., about the site,
            privacy policy, etc. Currently, the welcome panel provides this
            information, so no footer is necessary. In that case, the footer
            can be commented out.

            -->

            <!--
            <footer class="mdl-mini-footer mdl-color--primary">
                <div class="mdl-mini-footer__left-section">
                    <ul class="mdl-mini-footer__link-list">
                        <li><a href="#">About</a></li>
                        <li><a href="#">Privacy & Terms</a></li>
                    </ul>
                </div>
            </footer>
             -->

        </div>

        <!--

        ## Scripts
        --------------------------------------------------------------------------------------

        The only external script required by the application is the Material Design
        Lite script, which we get from Google's CDN.

        > Note: If the MDL script file is updated to a newer version, the CSS style
          sheet (see above) should probably also be updated to match.

        Code for some optional scripts is included below, though currently commented out.

        1. An in-app feedback option. Since this app has no server support, we
           use an external service ([Eager](https://eager.io)) to add a feedback
           option. Note that any feedback received is (currently) sent to me
           (stephen@sathomas.me), so subsequent owners probably should update
           the link to their own account.

        2. Standard Google Analytics boilerplate. There's no account (yet), so the site
           ID is left unspecified in the commented out code.

        > Note: If either of these third party services (or any other, for that
          matter) is enabled, the privacy statement on the welcome panel should
          be updated appropriately. Third party services are almost certainly
          collecting _some_ data.

        After loading the external script files, we define our own local code.
        That code is really the heart of the application.

        -->

        <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>

        <!-- Third party service that adds support for in-app feedback
        <script src='http://fast.eager.io/KBgHZ9aQoe.js'></script>
        -->

        <!-- Google Analytics: change UA-XXXXX-X to actual site ID
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,"script","ga"));
            ga("create","UA-XXXXX-X","auto");ga("send","pageview");
        </script>
        -->

        <!--

        ### Web Worker for Computations

        The mathematical calculations that the application requires can be
        computationally intensive, so we use a separate web worker (i.e.
        thread) for them. Doing so avoids slowing down the user interface
        during the calculations. The code for the web worker is embedded
        embedded is a separate `<script>` tag, but it's given the "type"
        of "javascript/worker" so that the browser's JavaScript engine
        won't parse it. We need a unique ID to reference the script when
        we instantiate it.

        TODO: This `<script>` block is a good candidate for moving into
        a separate file. Among other benefits, that should make automated
        testing much simpler.

        -->

        <script id="compute-script" type="javascript/worker">

            // #### Utility Functions

            // Generate a random value from the normal distribution.
            // See _A First Course of Probability_ by Sheldon Ross (pp. 464, 6ed).
            // The `mean` and `variance` parameters are optional; if
            // omitted the function assumes a standard normal N(0,1).

            var randNorm = function(mean, variance) {
                if (mean === undefined) { mean = 0.0; }
                if (variance === undefined) { variance = 1.0; }
                var v1, v2, s;
                do {
                    var u1 = Math.random();
                    var u2 = Math.random();
                    v1 = 2 * u1 - 1;
                    v2 = 2 * u2 - 1;
                    s = v1 * v1 + v2 * v2;
                } while (s > 1);

                var x = Math.sqrt(-2 * Math.log(s) / s) * v1;
                x = mean + Math.sqrt(variance) * x;
                return x;
            };

            // Calculate the product of a vector and a matrix and the
            // vector transposed, e.g. V * M * V'
            //
            // > Note: No error or bounds checking currently implemented

            var quadraticForm = function(v, m) {
                return v.reduce(function(sum, s, i) {
                    return sum + s * v.reduce(function(inner, t, j) {
                        return inner + t * m[i][j];
                    }, 0);
                }, 0);
            };

            // Compare two arrays for equality

            var areArraysSame = function (a,b) {
                return (a.length === b.length) &&
                    a.every(function(ai, i) {return ai === b[i];});
            };

            // #### Application-Specific Calculations

            // Cache results from previous calculations so we can avoid
            // unnecessary recalculations.

            var baselineRisk,
                stillBirthRate,
                risk,
                amnioLossRate,
                weights,
                interval;

            // Also cache the prior input values.

            var prevAge,
                prevMarkers = [],
                prevPriorities = [];

            // Calculate baseline risk based solely on maternal age

            var estimateBaselineRisk = function(age) {
                return 1/(1+Math.exp(7.330-4.211/(1+Math.exp(-0.2815*(age-37.23)))));
            };

            // Estimate the stillbirth rate based on the markers available.
            //
            //   * 7 markers = all        [NT; PAPPA; FBHCG1; AFP; UE3; INHIBINA; THCG]
            //   * 6 markers = integrated [NT; PAPPA; AFP; UE3; INHIBINA; THCG]
            //   * 4 markers = quadruple  [AFP; UE3; INHIBINA; THCG]
            //   * 3 markers = combined   [NT; PAPPA; FBHCG1]

            var estimateStillBirthRate = function(markers) {

                // If the markers indicate a combined test, we assume that
                // the pregnancy is in the first trimester. With more time
                // to full term, this introduces a higher risk of stillbirth
                if (markers.length === 3) {
                    return 0.43;
                } else {
                    return 0.23;
                }
            };

            // Calculate estimated risk based on age and lab results. The
            // specific method used depends on the number of markers provided.
            //
            //   * 7 markers = all        [NT; PAPPA; FBHCG1; AFP; UE3; INHIBINA; THCG]
            //   * 6 markers = integrated [NT; PAPPA; AFP; UE3; INHIBINA; THCG]
            //   * 4 markers = quadruple  [AFP; UE3; INHIBINA; THCG]
            //   * 3 markers = combined   [NT; PAPPA; FBHCG1]

            var estimateRisk = function(age, markers, stillBirthRate) {

                // Define variables we need for the calculation. We'll
                // set their values depending on the markers that are
                // available.
                var meanAff, meanUna, inverseCovarianceAff, inverseCovarianceUna,
                    sqrtDetCovAff, sqrtDetCovUna;

                switch (markers.length) {

                    // all test results
                    case 7:

                        meanAff = [ 0.2922, -0.3768, 0.2878, -0.1308, -0.1549, 0.3384, 0.3118 ];
                        meanUna = [ 0, 0, 0, 0, 0, 0, 0 ];
                        inverseCovarianceAff = [
                            [ 20.9798,  3.8504,  -3.0081, -3.22,    -9.9803, -3.6164,  1.6674 ],
                            [  3.8504, 16.2433,	 -2.9975, -4.8633, -14.3813,  0.4282,  3.1796 ],
                            [ -3.0081, -2.9975,	 21.2946,  2.4591,  12.3187, -1.2296, -8.4456 ],
                            [ -3.22,   -4.8633,   2.4591, 55.5283,   6.7838, -3.016,  -5.8457 ],
                            [ -9.9803, -14.3813, 12.3187,  6.7838,  98.2807,  7.5609,  5.5478 ],
                            [ -3.6164,   0.4282, -1.2296, -3.016,    7.5609, 18.6246, -6.0332 ],
                            [  1.6674,   3.1796, -8.4456, -5.8457,   5.5478, -6.0332, 26.9573 ]
                        ];
                        inverseCovarianceUna = [
                            [ 48.832,   1.5771,  -0.188,    0.1483,  -3.879,   0.7162,   1.68   ],
                            [  1.5771, 16.8675,  -2.6161,  -3.0731,  -3.8668,  0.4896,   0.6377 ],
                            [ -0.188,  -2.6161,  21.4729,   3.9484,  -0.4467, -2.2651, -13.344  ],
                            [  0.1483, -3.0731,   3.9484,  57.5189, -14.5487, -7.5444,  -5.1355 ],
                            [ -3.879,  -3.8668,  -0.4467, -14.5487,  82.48,    5.4684,   1.345  ],
                            [  0.7162,  0.4896,  -2.2651,  -7.5444,   5.4684, 29.7061,  -9.3419 ],
                            [  1.68,    0.6377, -13.344,   -5.1355,   1.345,  -9.3419,  32.2184 ]
                        ];
                        sqrtDetCovAff = 0.000010903;
                        sqrtDetCovUna = 0.0000049201;
                        break;

                    // integrated test results
                    case 6:

                        meanAff = [ 0.2922, -0.3010, -0.1308, -0.1549, 0.3384, 0.3118 ];
                        meanUna = [ 0, 0, 0, 0, 0, 0 ];
                        inverseCovarianceAff = [
                            [ 20.554880240537493,   3.426920428921216,  -2.872626262440822,  -8.240143407329521,  -3.790139512835841,   0.474378122622916 ],
                            [  3.426920428921216,  15.821371095506429,  -4.517108233290250, -12.647324627206020,   0.255157918471607,   1.990788732636366 ],
                            [ -2.872626262440822,  -4.517108233290250,  55.244292495460165,   5.361210199803712,  -2.874027057560135,  -4.870423974946864 ],
                            [ -8.240143407329521, -12.647324627206018,   5.361210199803711,  91.154514825055131,   8.272229531575455,  10.433432349542748 ],
                            [ -3.790139512835842,   0.255157918471607,  -2.874027057560137,   8.272229531575455,  18.553617181968647,  -6.520846471664629 ],
                            [  0.474378122622916,   1.990788732636366,  -4.870423974946863,  10.433432349542748,  -6.520846471664631,  23.607740696076391 ]
                        ];
                        inverseCovarianceUna = [
                            [ 57.358365961752945,  1.826316161214356,   0.215312293560837,  -4.559359610577901,   0.816111474811734,   1.837785150484615 ],
                            [ 1.826316161214356,  16.557460826361925,  -2.590991736098649,  -3.942799962120657,   0.217416458407900,  -0.979293197601671 ],
                            [ 0.215312293560837,  -2.590991736098649,  56.792997411878638, -14.469163578571125,  -7.127396773434530,  -2.680740597953040 ],
                            [ -4.559359610577900, -3.942799962120657, -14.469163578571127,  82.524331883598336,   5.411821855504203,   1.045645564606566 ],
                            [ 0.816111474811734,   0.217416458407899,  -7.127396773434532,   5.411821855504204,  29.468883687242776, -10.745723981046623 ],
                            [ 1.837785150484616,  -0.979293197601670,  -2.680740597953040,   1.045645564606565, -10.745723981046625,  23.934767642862120 ]
                        ];
                        sqrtDetCovAff = 5.031194646938435e-5;
                        sqrtDetCovUna = 2.103634472974705e-5;
                        break;

                    // quadruple test results
                    case 4:

                        meanAff = [ -0.1308, -0.1549, 0.3384, 0.3118 ];
                        meanUna = [ 0, 0, 0, 0 ];
                        inverseCovarianceAff = [
                            [ 53.773527794679616,   1.224407779523546,  -3.168824296555949,  -4.297912838981690 ],
                            [  1.224407779523548,  79.517259387930125,   7.408568888627167,  12.036819827272375 ],
                            [ -3.168824296555949,   7.408568888627167,  17.803151377283651,  -6.544573585366461 ],
                            [ -4.297912838981688,  12.036819827272375,  -6.544573585366462,  23.357147489000226 ]
                        ];
                        inverseCovarianceUna = [
                            [  56.383153220250158, -15.049992266679251,  -7.100319112508539,  -2.851044283837526 ],
                            [ -15.049992266679252,  81.287817109645474,   5.520755231464582,   0.952857913147896 ],
                            [  -7.100319112508540,   5.520755231464582,  29.455050761869895, -10.759831476140802 ],
                            [  -2.851044283837525,   0.952857913147895, -10.759831476140803,  23.810605916644072 ]
                        ];
                        sqrtDetCovAff = 8.907667313707855e-4;
                        sqrtDetCovUna = 6.471449357233173e-4;
                        break;

                    // combined test results
                    case 3:

                        meanAff = [ 0.2922, -0.3010, 0.3404 ];
                        meanUna = [ 0, 0, 0 ];
                        inverseCovarianceAff = [
                            [ 19.314547490997647,  2.292959915632461, -1.705040857351463 ],
                            [  2.292959915632461, 13.070398578561802,  0.763541772277445 ],
                            [ -1.705040857351463,  0.763541772277445, 15.375487566749186 ]
                        ];
                        inverseCovarianceUna = [
                            [ 56.864138408748879,  1.544508530420665,  1.003072106525415 ],
                            [  1.544508530420665, 16.424960968013934, -2.123697304646387 ],
                            [  1.003072106525415, -2.123697304646387, 14.529295377184575 ]
                        ];
                        sqrtDetCovAff = 0.016339833569356;
                        sqrtDetCovUna = 0.008685476472149;
                        break;

                    // unexppected input
                    default:

                        return 0;

                }

                // The actual calculations are the same for all test types.

                var ageRisk = estimateBaselineRisk(age),
                    ageOdds = ageRisk/(1 - ageRisk);

                markers = markers.map(function(marker) {
                    return Math.log(marker)/Math.log(10);
                });

                var diffAff = meanAff.map(function(aff, idx) {
                    return markers[idx]- aff;
                });

                var diffUna = meanUna.map(function(una, idx) {
                    return markers[idx]- una;
                });

                var valueAff = quadraticForm(diffAff, inverseCovarianceAff),
                    valueUna = quadraticForm(diffUna, inverseCovarianceUna);

                var odds = ( ( Math.exp( -0.5 * valueAff) / sqrtDetCovAff ) /
                             ( Math.exp( -0.5 * valueUna) / sqrtDetCovUna ) ) *
                            ageOdds / ( 1 - stillBirthRate);

                return odds / (1 + odds);

            };

            var estimateAmnioLossRate = function() {
                return 0.003; // Estimated loss rate from Amniocentesis is constant
            };

            // Calculate ultimate decision weights given estimated risk and
            // priority ratings.
            //     priorities = [misDs, misHealthy, testTerm, testStill, testDs,
            //                   testHealthy, notestStill, notestDs, notestHealthy];
            //     returns [amnio, noAmnio]

            var calcWeights = function(risk, stillBirthRate, amnioLossRate, priorities) {

                var amnio = amnioLossRate * risk * priorities[0] +
                            amnioLossRate * (1-risk) * priorities[1] +
                            (1-amnioLossRate) * risk * Math.max( priorities[2],
                                stillBirthRate * priorities[3] +
                                    (1-stillBirthRate) * priorities[4])  +
                            (1-amnioLossRate) * (1-risk) * priorities[5];
                var noAmnio = risk * stillBirthRate * priorities[6] +
                              risk * (1-stillBirthRate) * priorities[7] +
                              (1-risk) * priorities[8];
                return [amnio, noAmnio];

            };

            // Estimate a confidence interval using statistical bootstrapping.
            // Inputs are the same as `estimateRisk()`

            estimateConfidence = function(age, markers, stillBirthRate) {

                // Number of bootstrap samples to synthesize
                var numBootstrap = 10000;

                // Coefficient of variation
                var cv = 0.05;

                // Determine the upper and lower bounds based on the
                // type of test results available.
                var numMarkers = markers.length,
                    lower = [0.5, 0.2, 0.3, 0.4, 0.4, 0.3, 0.4],
                    upper = [2.5, 3.0, 5.0, 3.0, 2.0, 5.0, 5.0];

                switch (numMarkers) {
                    // all test results
                    case 7:
                        break;
                    // integrated test results
                    case 6:
                        lower.splice(2,1);
                        upper.splice(2,1);
                        break;
                    // quadruple test results
                    case 4:
                        lower = lower.slice(3);
                        upper = upper.slice(3);
                        break;
                    // combined test results
                    case 3:
                        lower = lower.slice(0,3);
                        upper = upper.slice(0,3);
                        break;
                    // unexppected input
                    default:
                        return [0,0];

                }

                // Define function to create a random sample value. We're
                // defining this function explicitly so we can reference it
                // in the loop that following and avoid re-defining it
                // within the loop.
                function sampleValue(marker, idx) {
                    var s2 = marker*marker*cv*cv,
                        x = randNorm(marker, s2);
                    return Math.min(Math.max(x, lower[idx]), upper[idx]);
                }

                for (var i=numBootstrap, samples=[]; i > 0; i--) {
                    samples.push(estimateRisk(age, markers.map(sampleValue), stillBirthRate));
                }

                samples.sort(function(a, b) {
                    return a - b;
                });

                return [samples[0.025 * numBootstrap], samples[0.975 * numBootstrap]];

            };

            // #### Main Processing Loop for Compute Worker

            // This thread is driven by messages from the parent, so
            // add an event listener to trigger the work. The actual
            // message from the parent is in `ev.data`.

            self.addEventListener('message', function(ev) {

                if (ev.data === "test") {
                    test();
                    return;
                }

                // Extract the inputs as an array of numbers. The
                // first number is the maternal age and the remaining
                // numbers are the marker values.
                var data = JSON.parse(ev.data);

                // Calculate the various values, but only if any of the
                // relevant inputs have changed.
                if (data.age !== prevAge) {
                    baselineRisk = estimateBaselineRisk(data.age);
                }
                if (!areArraysSame(data.markers, prevMarkers)) {
                    stillBirthRate = estimateStillBirthRate(data.markers);
                }
                if ((data.age !== prevAge) || !areArraysSame(data.markers, prevMarkers)) {
                    risk = estimateRisk(data.age, data.markers, stillBirthRate);
                    interval = estimateConfidence(data.age, data.markers, stillBirthRate);
                }
                amnioLossRate  = estimateAmnioLossRate();
                if ((data.age !== prevAge) || !areArraysSame(data.markers, prevMarkers) ||
                    !areArraysSame(data.priorities, prevPriorities)) {
                    weights = calcWeights(risk, stillBirthRate, amnioLossRate, data.priorities);
                }

                // Cache the input for future calls.
                prevAge = data.age;
                prevMarkers = data.markers.slice(0);
                prevPriorities = data.priorities.slice(0);

                // Return the result to the parent script.
                self.postMessage(JSON.stringify({
                    'baselineRisk': baselineRisk,
                    'estimateRisk': {
                        'low':  interval[0],
                        'mean': risk,
                        'high': interval[1]
                    },
                    'stillBirthRate': stillBirthRate,
                    'amnioLossRate': amnioLossRate,
                    'weights': weights
                }));

            }, false);

            // ### Test Code

            var test = function() {

                // #### Tests for estimated risk

                console.log(estimateRisk(30, [1.5,3.0,4.9,3.0,0.4,0.3,0.5], 0.23),
                    "should be 0.005042677866648");
                console.log(estimateRisk(30, [0.5,0.2,0.3,0.4,0.4,0.3,0.4], 0.23),
                    "should be 3.436517371529128e-05");
                console.log(estimateRisk(30, [2.5,3.0,5.0,3.0,2.0,5.0,5.0], 0.23),
                    "should be 1.128942262511341e-06");
                console.log(estimateRisk(30, [2.5,0.2,5.0,0.4,0.4,5.0,5.0], 0.23),
                    "should be 0.999995045281023");
                console.log(estimateRisk(30, [0.5,3.0,0.3,3.0,2.0,0.3,0.4], 0.23),
                    "should be 1.200434076898316e-08");
                console.log(estimateRisk(30, [2.1294,2.7362,0.8968,2.7748,1.4118,0.7584,1.6811], 0.23),
                    "should be 3.447781779787803e-06");
                console.log(estimateRisk(20, [2.5,0.2,5.0,0.4,0.4,5.0,5.0], 0.23),
                    "should be 0.999992199210378");
                console.log(estimateRisk(40, [0.5,3.0,0.3,3.0,2.0,0.3,0.4], 0.23),
                    "should be 1.324037738264033e-07");
                console.log(estimateRisk(45, [2.23,1.54,4.30,1.25,1.03,4.37,3.33], 0.23),
                    "should be 0.387268998361568");
                console.log(estimateRisk(30, [2.5,3.0,3.0,2.0,5.0,5.0], 0.23),
                    "should be 1.610812901764032e-05");
                console.log(estimateRisk(30, [2.1294,2.7362,2.7748,1.4118,0.7584,1.6811], 0.23),
                    "should be 7.937697582244133e-06");
                console.log(estimateRisk(45, [2.23,1.54,1.25,1.03,4.37,3.33], 0.23),
                    "should be 0.685650139633800");
                console.log(estimateRisk(30, [0.4,0.4,0.3,0.4], 0.23),
                    "should be 3.514910936568825e-05");
                console.log(estimateRisk(30, [3.0,2.0,0.3,0.4], 0.23),
                    "should be 2.065668589689288e-08");
                console.log(estimateRisk(40, [3.0,2.0,0.3,0.4], 0.23),
                    "should be 2.278361621669848e-07");
                console.log(estimateRisk(30, [1.5,3.0,4.9], 0.43),
                    "should be 0.001933011307172");
                console.log(estimateRisk(30, [2.5,0.2,5.0], 0.43),
                    "should be 0.984876005589030");
                console.log(estimateRisk(20, [2.5,0.2,5.0], 0.43),
                    "should be 0.976393552861281");

                // #### Tests for confidence intervals

                console.log(estimateConfidence(30, [1.5,3.0,4.9], 0.43),
                    "should be about 0.0012, 0.0034");
                console.log(estimateConfidence(30, [0.4,0.4,0.3,0.4], 0.23),
                    "should be about 0.3266e-04, 0.5465e-04");
                console.log(estimateConfidence(30, [2.5,3.0,3.0,2.0,5.0,5.0], 0.23),
                    "should be about 0.0602e-04, 0.4647e-04");
                console.log(estimateConfidence(30, [2.5,0.2,5.0], 0.43),
                    "should be about 0.9562, 0.9849");
                console.log(estimateConfidence(30, [3.0,2.0,0.3,0.4], 0.23),
                    "should be about 0.1897e-07, 0.3976e-07");
                console.log(estimateConfidence(30, [2.1294,2.7362,2.7748,1.4118,0.7584,1.6811], 0.23),
                    "should be about 0.0278e-04, 0.2365e-04");
                console.log(estimateConfidence(20, [2.5,0.2,5.0], 0.43),
                    "should be about 0.9327, 0.9764");
                console.log(estimateConfidence(40, [3.0,2.0,0.3,0.4], 0.23),
                    "should be about 0.2093e-06, 0.4385e-06");
                console.log(estimateConfidence(45, [2.23,1.54,1.25,1.03,4.37,3.33], 0.23),
                     "should be 0.3911, 0.8806");

                // #### Tests for weights

                console.log(calcWeights(0.005, 0.23, 0.003, [7.2,6.0,7.5,6.4,7.8,10.0,6.8,6.2,9.1 ]),
                    "should be 9.975555499999999,9.086189999999998");
                console.log(calcWeights(0.005, 0.23, 0.003, [8.0,8.0,9.0,8.0,6.0,10.0,8.0,7.0,10.0]),
                    "should be 9.989015000000000, 9.986149999999999");
                console.log(calcWeights(0.99, 0.23, 0.003, [8.0,8.0,9.0,8.0,6.0,10.0,8.0,7.0,10.0]),
                    "should be 9.006969999999999,7.257700000000000");
                console.log(calcWeights(0.00001, 0.23, 0.003, [8.0,8.0,9.0,8.0,6.0,10.0,8.0,7.0,10.0]),
                    "should be 9.993990030000001, 9.999972300000000");
                console.log(calcWeights(0.5, 0.23, 0.003, [6.0,6.0,9.0,6.0,9.2,10.0,6.0,9.2,10.0]),
                    "should be 9.489500000000000, 9.231999999999999");
                console.log(calcWeights(0.1, 0.23, 0.003, [6.0,6.0,9.0,6.0,9.2,10.0,6.0,9.2,10.0]),
                   "should be 9.888299999999999, 9.846399999999999");

            };

        </script>

        <!--
        Now we have our main JavaScript code.
        -->

        <script>

            // ### Generic Utility Functions

            // Check to see if HTML5 localStorage is available. Returns
            // a boolean result.

            var hasLocalStorage = function() {
            	try {
            		var storage = window.localStorage,
            			x = '__storage_test__';
            		storage.setItem(x, x);
            		storage.removeItem(x);
            		return true;
            	}
            	catch(e) {
            		return false;
            	}
            };

            // Format a number to the specified number of
            // decimal places.

            var formatNumber = function(x, decimals) {
                var s = "" + Math.round(x * Math.pow(10, decimals)) / Math.pow(10, decimals);

                if (decimals) {
                    if (s.indexOf(".") === -1) { s += "."; }
                    for (var r = s.split(".")[1].length; r < decimals; r++) {
                        s += "0";
                    }
                }

                return s;
            };

            // Format a value between 0 and 1 as a percentage.

            var formatPercentage = function(x) {
                if (x >= 0.10) {
                    return Math.round(x * 100) + "%";
                } else if (x >= 0.01) {
                    return (Math.round(x * 1000) / 10) + "%";
                } else {
                    return (Math.round(x * 10000) / 100) + "%";
                }
            };

            // ### Application State

            // State of the overall application that is shared by multiple
            // components.

            var currentPanel = "welcome",   // active tab panel
                hasInputChanged = false,    // has the user changed *any* input?
                hasVisitedResults = false,  // has the user visisted a results panel?
                areInputsValid = false,     // are all inputs valid?
                areInputsSuspect = false,   // are inputs suspect?
                doAmnio = false,            // is amnio recommended?
                inputObjs = {},             // hash of all input objects
                barObjs = {},               // hash of all bar objects
                inputs = [],                // array of all input objects
                infos = [],                 // array of all info objects
                ratings = [],               // array of all rating objects
                resultGauge;                // the result gauge object

            // ### Control the Web Worker for Computation

            // Set up the web worker object

            var compute = new Worker(
                window.URL.createObjectURL(
                    new Blob([document.querySelector('#compute-script').textContent])
                )
            );

            // Listen for messages from the compute worker and dispatch the
            // response.

            compute.addEventListener('message', function(ev) {

                // Update count of number of calculation threads
                // in progress.
                var body = document.getElementsByTagName("body")[0],
                    cnt = +body.getAttribute("data-computing") - 1;
                body.setAttribute("data-computing", cnt);

                updateResults(JSON.parse(ev.data));
                updateContentVisibility();
            });

            // Trigger calculation of risk estimates based on age and lab results.

            var startCompute = function() {

                // Get the input values from the user controls
                var age = inputObjs.infoAge.value();

                // First get all possible marker values
                var markers = [
                    inputObjs.infoNt.value(),
                    inputObjs.infoPappa.value(),
                    inputObjs.infoFbhcg.value(),
                    inputObjs.infoAfp.value(),
                    inputObjs.infoUe3.value(),
                    inputObjs.infoInhibina.value(),
                    inputObjs.infoHcg.value()
                ];

                // Then prune the markers array to include only
                // those values that are relevant.
                switch (analysisAvailable()) {
                    case "integrated":
                        markers.splice(2,1);
                        break;
                    case "quadruple":
                        markers = markers.slice(3);
                        break;
                    case "combined":
                        markers = markers.slice(0,3);
                        break;
                }

                // Next get the expressed priorities from
                // the ratings objects.
                var priorities = [
                    inputObjs.ratingMisDs.value(),
                    inputObjs.ratingMisHealthy.value(),
                    inputObjs.ratingTestTerm.value(),
                    inputObjs.ratingTestStill.value(),
                    inputObjs.ratingTestDs.value(),
                    inputObjs.ratingTestHealthy.value(),
                    inputObjs.ratingNotestStill.value(),
                    inputObjs.ratingNotestDs.value(),
                    inputObjs.ratingNotestHealthy.value()
                ];

                // Keep track of how many computing threads are
                // active so we'll know when they're all done.
                var body = document.getElementsByTagName("body")[0],
                    cnt = +body.getAttribute("data-computing") + 1;
                body.setAttribute("data-computing", cnt);

                // Signal the compute worker to perform the
                // calculations.
                compute.postMessage(JSON.stringify({
                    'age':        age,
                    'markers':    markers,
                    'priorities': priorities
                }));

            };

            // ### State Management

            // Are markers ready? Returns empty string if not; otherwise returned
            // string indicates type of analysis that is available. Possible values:
            // "all", "integrated", "quadruple", and "combined".

            var analysisAvailable = function() {
                if (["infoNt", "infoPappa", "infoFbhcg", "infoAfp", "infoUe3",
                     "infoInhibina", "infoHcg"].every(function(marker) {
                    return typeof inputObjs[marker].value() !== "undefined";
                })) {
                    return "all";
                } else if (["infoNt", "infoPappa", "infoAfp", "infoUe3", "infoInhibina",
                            "infoHcg"].every(function(marker) {
                    return typeof inputObjs[marker].value() !== "undefined";
                })) {
                    return "integrated";
                } else if (["infoAfp", "infoUe3", "infoInhibina",
                            "infoHcg"].every(function(marker) {
                    return typeof inputObjs[marker].value() !== "undefined";
                })) {
                    return "quadruple";
                } else if (["infoNt", "infoPappa", "infoFbhcg"].every(function(marker) {
                    return typeof inputObjs[marker].value() !== "undefined";
                })) {
                    return "combined";
                } else {
                    return "";
                }
            };

            // Evaluate the user inputs, updating application state as appropriate.

            var evaluateInputs = function() {

                // Get the range of rating values. We need this to determine whether
                // or not the results are "suspect."
                var minRating = Math.min.apply(null, ratings.map(function(r) {
                    return r.value();})
                );
                var maxRating = Math.max.apply(null, ratings.map(function(r) {
                    return r.value();})
                );

                // Are all the inputs ready and valid?
                areInputsValid = inputs.every(function(i) {
                        // If an input is required, its value can't be undefined.
                        return !i.required() || typeof i.value() !== "undefined";
                    }) &&
                    [].slice.call(document.getElementsByTagName("form")).every(function(f) {
                        // All form elements should validate.
                        return f.checkValidity();
                    }) && (analysisAvailable() !== "");

                // Two conditions cause suspect inputs:
                //   1. The range of values for min and max ratings are limited
                //   2. Every rating is an extreme.
                areInputsSuspect = ((maxRating - minRating) < 4) ||
                    ratings.every(function(r) {return r.value() < 1 || r.value() > 9;});

            };

            // Update the results from the calculations

            var updateResults = function(results) {

                // Update the main gauge.
                resultGauge.value((10 + (results.weights[0] - results.weights[1]))/20);

                // Update the results table.
                document.getElementById("results-no-amnio").textContent =
                    formatNumber(results.weights[1],2);
                document.getElementById("results-amnio").textContent =
                    formatNumber(results.weights[0],2);

                // Update the analysis results.
                barObjs.barBaseline.value(results.baselineRisk);
                barObjs.barRisk.value(results.estimateRisk.mean).
                    confidence([results.estimateRisk.low,results.estimateRisk.high]);
                barObjs.barMis.value(results.amnioLossRate);
                barObjs.barStill.value(results.stillBirthRate);
                document.getElementById("risk-low").textContent =
                    formatPercentage(results.estimateRisk.low);
                document.getElementById("risk-mean").textContent =
                    formatPercentage(results.estimateRisk.mean);
                document.getElementById("risk-high").textContent =
                    formatPercentage(results.estimateRisk.high);

                // Update state
                doAmnio = results.weights[0] > results.weights[1];

            };

            // #### updateContentVisibility()

            // Update the `data-` attributes that control content visibility.

            var updateContentVisibility = function() {

                // Add attributes to the markup so that CSS rules can change
                // visibility appropriately.
                var body = document.getElementsByTagName("body")[0];
                body.setAttribute("data-results-ready", areInputsValid);
                body.setAttribute("data-priorities-limited", areInputsValid && areInputsSuspect);
                body.setAttribute("data-amnio", doAmnio);

                var analysis = analysisAvailable();

                body.setAttribute("data-lab-partial", "");
                if (hasVisitedResults &&
                    (analysis === "quadruple") && (["infoNt", "infoPappa", "infoAfp"].
                        some(function(marker) {
                            return typeof inputObjs[marker].value() !== "undefined";
                        }))
                    ) {
                    body.setAttribute("data-lab-partial", "first");
                }
                if (hasVisitedResults &&
                    (analysis === "combined") &&
                    (["infoAfp", "infoUe3", "infoInhibina", "infoHcg"].some(function(marker) {
                            return typeof inputObjs[marker].value() !== "undefined";
                    }))) {
                    body.setAttribute("data-lab-partial", "second");
                }

                var lab = {
                    all: "both",
                    integrated: "both",
                    quadruple: "second",
                    combined: "first"
                };
                body.setAttribute("data-lab", lab[analysis]);

            };

            // #### saveInputState()

            // Save the state of all inputs in local storage (so it can be restored
            // if/when the user reloads the app).

            var saveInputState = function() {
                if (hasLocalStorage()) {
                    inputs.forEach(function(i) {
                        if (i.hasChanged()) {
                            if (typeof(i.value()) === "undefined") {
                                localStorage.removeItem(i.id());
                            } else {
                                localStorage.setItem(i.id(), i.value());
                            }
                        }
                    });
                }
            };

            // #### restoreInputState()

            // Restore previously saved input state (if it's available in
            // local storage).

            var restoreInputState = function() {
                if (hasLocalStorage()) {
                    inputs.forEach(function(i) {
                        if (localStorage.getItem(i.id()) !== null) {
                            i.value(localStorage.getItem(i.id()));
                        }
                    });
                }
            };

            // #### setTabPanel()

            // Make a specific tab panel active. The input parameter
            // is a string that corresponds to the href hash for
            // the desired panel.

            var setTabPanel = function(panel) {

                    // Note that this panel has now been viewed by the user. (Well,
                    // it will have been viewed once we finish this handler.)
                    panelViewed(panel);

                    // Simulate the effect of selecting the corresponding tab panel
                    // using the tabs themselves. Essentially that's nothing
                    // more than managing the `is-active` class on the tabs
                    // and the panels. The MDL style transitions take care
                    // of the rest.

                    // First we remove the `is-active` class from all the tabs
                    // and panels.
                    [].slice.call(document.querySelectorAll(".mdl-layout__tab-bar a")).
                        forEach(function(anchor) {
                            anchor.classList.remove("is-active");
                        }
                    );
                    [].slice.call(document.querySelectorAll(".mdl-layout__tab-panel")).
                        forEach(function(section) {
                            section.classList.remove("is-active");
                        }
                    );

                    // Now we add the `is-active` class back to the targeted tab
                    // and panel.
                    document.querySelector(".mdl-layout__tab-bar a[href='#" + panel + "']").
                        classList.add("is-active");
                    document.getElementById(panel).classList.add("is-active");

                    // Also, go ahead and position the window at the top
                    // of the new panel. If we don't take this action, some
                    // browsers leave the scroll position as-is (i.e. as it
                    // was in the old tab panel). That is not good.
                    document.getElementsByTagName('main')[0].scrollTop = 0;
            };

            // ### Components

            // #### Info

            // The Info object encapsulates the behavior
            // of an input element that accepts user input.

            function Info(el) {

                // ##### Private Properties and Attributes

                var element,                // Containing element for the info component
                    input,                  // Actual input control
                    required = false,       // Is input required?
                    hasChanged = false,     // Has the user changed the input?
                    validateOnBlur = false, // Force validation on blur?
                    callback;               // Callback for value changes

                // ##### Private Methods and Functions

                var setElement = function(el) {

                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    input = element.getElementsByTagName("input")[0];

                    // Set/update event handlers
                    input.addEventListener("change", handleChange);
                    input.addEventListener("blur", handleBlur);

                };

                // ##### Event Handlers

                var handleChange = function(ev) {
                    hasChanged = true;
                    if (typeof callback === "function") {
                        callback(ev);
                    }
                };

                var handleBlur = function(ev) {

                    // We don't use `required` attributes initially
                    // to avoid a bunch of error messages on an
                    // empty form. But we will add the attribute
                    // after the user visits the input.
                    if (required) {
                        exports.markRequired();
                    }
                    if (validateOnBlur) {
                        exports.checkValidity();
                    }

                };

                // ##### Object to be Returned

                function exports() { }

                // ##### Public API Methods

                exports.callback = function(fn) {
                    if (!arguments.length) { return callback; }
                    callback = fn;
                    return this;
                };

                exports.checkValidity = function() {
                    return element.MaterialTextfield.checkValidity();
                };

                exports.hasChanged = function() {
                    return hasChanged;
                };

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };

                exports.id = function(s) {
                    if (!arguments.length) { return input.getAttribute("id"); }
                    input.setAttribute("id", s);
                    return this;
                };

                exports.markRequired = function() {
                    input.setAttribute("required", "required");
                };

                exports.required = function(b) {
                    if (!arguments.length) { return required; }
                    required = b;
                    return this;
                };

                exports.validateOnBlur = function(b) {
                    if (!arguments.length) { return validateOnBlur; }
                    validateOnBlur = b;
                    return this;
                };

                exports.value = function(x) {
                    if (!arguments.length) {
                        if (input && input.value) {
                            return parseFloat(input.value);
                        }
                        return undefined;
                    }
                    if (element) {
                        element.MaterialTextfield.change(x);
                    }
                    return this;
                };

                // ##### Initialization

                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            }

            // #### Rating

            // The Rating object encapuslates the behavior of a
            // rating component on the page. The optional input
            // parameter of the constructor is the parent HTML
            // element.

            function Rating(el) {

                // ##### Private Properties and Attributes

                var element,             // Containing element for the rating component
                    input,               // Actual input control
                    lowIcon,             // Icon for low value
                    highIcon,            // Icon for high value
                    keys,                // Key values
                    colorMin = false,    // Preserve color on minimum value?
                    hasChanged = false,  // Has the user changed the input?
                    callback;            // Callback for value changes

                // ##### Private Methods and Functions

                var setElement = function(el) {

                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    input = element.getElementsByTagName("input")[0];
                    lowIcon = element.getElementsByTagName("i")[0];
                    highIcon = element.getElementsByTagName("i")[1];
                    keys = [].slice.call(element.getElementsByClassName("rating--key"));

                    // Set/update event handlers
                    input.addEventListener("input", handleInput);
                    input.addEventListener("change", handleChange);

                };

                var update = function() {
                    // Cache the current value
                    var value = parseFloat(input.value);

                    // Update the icons
                    lowIcon.style.opacity = value < 6 ? 1 : 0.25 + ((10 - value)/6);
                    highIcon.style.opacity = value > 4 ? 1 : 0.25 + (value/6);

                    // Update the keys
                    keys.forEach(function(key, idx) {
                        idx = 20/8 * idx;
                        if (Math.abs(value - idx) < 2) {
                            key.style.opacity = (2 - Math.abs(value - idx)) / 2;
                        } else {
                            key.style.opacity = 0;
                        }
                    });
                };

                // ##### Event Handlers

                var handleInput = function(ev) {
                    if (colorMin) {
                        // We don't want special styling on lowest value
                        setTimeout(function() {
                            input.classList.remove("is-lowest-value");
                        }, 0);
                    }
                    update();
                };

                var handleChange = function(ev) {

                    hasChanged = true;

                    // IE10 doesn't fire input events, so fire one for it
                    handleInput(ev);

                    if (typeof callback === "function") {
                        callback(ev);
                    }

                };

                // ##### Object to be Returned

                function exports() { }

                // ##### Public API Methods

                exports.callback = function(fn) {
                    if (!arguments.length) { return callback; }
                    callback = fn;
                    return this;
                };

                exports.hasChanged = function() {
                    return hasChanged;
                };

                exports.colorMin = function(b) {
                    if (!arguments.length) { return colorMin; }
                    colorMin = b;
                    return this;
                };

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };

                exports.id = function(s) {
                    if (!arguments.length) { return input.getAttribute("id"); }
                    input.setAttribute("id", s);
                    return this;
                };

                exports.required = function() {
                    // Ratings are always (effectively) required
                    return true;
                };

                exports.value = function(x) {
                    if (!arguments.length) {
                        if (input && input.value) {
                            return parseFloat(input.value);
                        }
                        return undefined;
                    }
                    if (input) {
                        input.MaterialSlider.change(x);
                        handleChange();
                    }
                    return this;
                };

                // ##### Initialization

                if (arguments.length) {
                    setElement(el);
                    update();
                }

                return exports;

            }

            // #### Gauge

            // The Gauge object encapsulates the behavior
            // of simple gauge. Most of the implementation
            // is in the CSS rules, but we do have a bit
            // of JavaScript to set or read the gauge value

            function Gauge(el) {

                // ##### Private Properties and Attributes

                var element,      // Containing element for the info component
                    data,         // `.gauge--data` element
                    needle,       // `.gauge--needle` element
                    value = 0.0,  // Current gauge value from 0 to 1
                    prop;         // Style for transform

                // ##### Private Methods and Functions

                var setElement = function(el) {
                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    data = element.querySelector(".gauge--data");
                    needle = element.querySelector(".gauge--needle");
                };

                var setValue = function(x) {
                    value = x;
                    var turns = -0.5 + (x * 0.5);
                    data.style[prop] = "rotate(" + turns + "turn)";
                    needle.style[prop] = "rotate(" + turns + "turn)";
                };

                // ##### Object to be Returned

                function exports() { }

                // ##### Public API Methods

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };

                exports.value = function(x) {
                    if (!arguments.length) { return value; }
                    setValue(x);
                    return this;
                };

                // ##### Initialization

                var body = document.getElementsByTagName("body")[0];
                ["webkitTransform", "mozTransform", "msTransform", "oTransform", "transform"].
                    forEach(function(p) {
                        if (typeof body.style[p] !== "undefined") { prop = p; }
                    }
                );

                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            }

            // #### Bar

            // The Bar object encapsulates the behavior of a
            // simple, single bar. Most of the implementation
            // is in the CSS rules, but we do have a bit
            // of JavaScript to set or read the bar value

            function Bar(el) {

                // ##### Private Properties and Attributes

                var element,           // Containing element for the info component
                    data,              // `.bar--data` element
                    range,             // `.bar--range` element
                    needle,            // `.bar--needle` element
                    text,              // `.bar--text` element
                    value = 0.0,       // Current bar value from 0 to 1
                    confidence = [];   // Confidence interval for value [min, max]

                // ##### Private Methods and Functions

                var updateBar = function() {
                    text.textContent = formatPercentage(value);
                    data.style.width = (value * 100) + "%";
                    needle.style.left = "calc(" + (value * 100) + "% - 1.5px)";
                    if (confidence.length === 2) {
                        range.style.display = 'block';
                        range.style.left = (confidence[0] * 100) + "%";
                        range.style.width = ((confidence[1] - confidence[0]) * 100) + "%";
                    } else {
                        range.style.display = 'none';
                    }
                    text.style.left = "calc(" + (value * 100) + "% - " +
                        (text.offsetWidth/2 - 2) + "px)";
                };

                var setElement = function(el) {
                    // Keep a reference to the various elements and sub-elements
                    element = el;
                    data = element.querySelector(".bar--data");
                    text = element.querySelector(".bar--text");
                    range = element.querySelector(".bar--range");
                    needle = element.querySelector(".bar--needle");
                };

                var setValue = function(x) {
                    value = x;
                    updateBar();
                };

                var setConfidence = function(x) {
                    confidence = x;
                    updateBar();
                };

                // ##### Object to be Returned

                function exports() { }

                // ##### Public API Methods

                exports.element = function(el) {
                    if (!arguments.length) { return element; }
                    setElement(el);
                    return this;
                };

                exports.id = function(s) {
                    if (!arguments.length) { return el.getAttribute("id"); }
                    el.setAttribute("id", s);
                    return this;
                };

                exports.update = function() {
                    updateBar();
                    return this;
                };

                exports.value = function(x) {
                    if (!arguments.length) { return value; }
                    setValue(x);
                    return this;
                };

                exports.confidence = function(x) {
                    if (!arguments.length) { return confidence; }
                    setConfidence(x);
                    return this;
                };

                // ##### Initialization

                if (arguments.length) {
                    setElement(el);
                }

                return exports;

            }

            // ### High Level Event Handlers

            // #### inputChanged()

            // The user has changed an input's value.

            var inputChanged = function(ev) {

                // Note the fact that the user has changed an input.
                hasInputChanged = true;

                // Whenever the user updates an input, we save the new
                // state (in local storage) evaluate the current state
                // of our inputs, and revise the calculations.
                saveInputState();
                evaluateInputs();
                if (areInputsValid) {
                    startCompute();
                }
            };

            // #### panelViewed()

            // The user has viewed a panel in the tab navigation of the
            // app. The input paramter is a string with the hashtag value
            // of the viewed panel.

            var panelViewed = function(panel) {

                // There are two specific panels that we want to watch
                // for. Both are panels that show analysis results.
                if (panel === "advice" || panel === "details") {

                    // If the user is now viewing one of the results panels, note the fact.
                    hasVisitedResults = true;

                    // And if the user has changed at least one input, we can enable
                    // validation so that missing values are highlighted. We only do
                    // this if the user has changed an input in case she is just
                    // checking out the various panels.
                    if (hasInputChanged) {
                        infos.forEach(function(info) {
                            if (info.required()) {
                                info.markRequired();
                                info.checkValidity();
                            }
                        });
                    }

                }

                // If the new panel is the details panel, we need to update
                // the bar values. If the text position of the values was set
                // while the panel was hidden, it may be incorrect because the
                // size of the text label wasn't accurately known.
                if (panel === "details") {
                    for (var bar in barObjs) {
                        barObjs[bar].update();
                    }
                }

                // If the panel has changed, save the new value in local storage.
                if (hasLocalStorage() && (currentPanel !== panel)) {
                    localStorage.setItem("panel", panel);
                }

                // Note the new panel.
                currentPanel = panel;

                // Update the content visibility so that warnings and
                // other information can reflect the user's path.
                updateContentVisibility();

            };

            // ### Initialization

            // Start initialization once the window is loaded.

            window.addEventListener('load', function() {

                // #### Behavior Initialization

                // ##### Buttons and Anchor tags that Change Tab Panels

                // Look for all the `<button>` and `<a> elements that have a `data-onclick`
                // attribute (that will indicate a new section). Those are buttons and links
                // that (are intended to) take the user to a different tab panel. Since MDL
                // doesn't have support for handling this function, we create our own event
                // handler forthem and force a change of panel.

                [].slice.call(document.querySelectorAll("button[data-onclick], a[data-onclick]")).
                    forEach(function(el) {
                        el.addEventListener("click", function(ev) {

                            // Don't process links, etc.
                            ev.preventDefault();

                            // What panel is the user navigating to?
                            var target = el.getAttribute("data-onclick");

                            // Make the desired panel active.
                            setTabPanel(target);

                        });
                    }
                );

                // ##### Hook Changes to Active Tab Panel

                // We need to spy on changes to the active tab panel in order to
                // update the page intelligently.

                [].slice.call(document.getElementsByClassName("mdl-layout__tab")).
                    forEach(function(el) {
                        var target = el.getAttribute("href"),
                            panel = target.substring(1);
                        el.addEventListener("click", function() {
                            panelViewed(panel);
                        });
                    }
                );

                // #### Component Initialization

                // Unlike traditional JavaScript MV* frameworks/libraries, we
                // don't rely on templates to dynamically render content. Instead
                // we "pre-render" the content by creating it within the static
                // markup. This approach, in effect, is the same as server-side
                // rendering for the initial state, and it make the page render
                // significantly faster.

                // ##### Initialize Info Components

                [].slice.call(document.getElementsByClassName("info")).forEach(function(el) {
                    var obj = new Info(el);

                    // Age information is required in all cases.
                    if (obj.id() === "infoAge") {
                        obj.required(true).validateOnBlur(true);
                    }

                    // Now that we have an Info component, add it to the application
                    // state as appropriate. It's both a generic input (so it goes
                    // in the `inputObjs` object and the `inputs` array), and a
                    // specific Info object.
                    inputObjs[obj.id()] = obj;
                    inputs.push(obj);
                    infos.push(obj);

                    // Register our event handler if the user changes the input.
                    obj.callback(inputChanged);
                });

                // ##### Initialize Rating Components

                [].slice.call(document.getElementsByClassName("rating")).
                    forEach(function(el) {
                        var obj = new Rating(el);

                        // Now that we have a Rating component, add it to the application
                        // state as appropriate. It's both a generic input (so it goes
                        // in the `inputObjs` object and the `inputs` array), and a
                        // specific Rating object.
                        inputObjs[obj.id()] = obj;
                        inputs.push(obj);
                        ratings.push(obj);

                        // Register our event handler if the user changes the input.
                        obj.callback(inputChanged);
                    }
                );

                // ##### Initialize Result Gauge Component

                resultGauge = new Gauge(document.getElementById("gaugeResult"));

                // ##### Initialize Bar Components

                [].slice.call(document.getElementsByClassName("bar")).
                    forEach(function(el) {
                        var obj = new Bar(el);

                        // Now that we have a Bar component, add it to the application
                        // state as appropriate.
                        barObjs[obj.id()] = obj;
                    }
                );

                // #### Restore Input State

                // We defer execution of the actual restore code
                // until the stack has unwound. That avoids any
                // race condition between this function and the
                // initialization of the input components. Once the
                // values are restored, we can evaluate them and
                // update the app as appropriate.
                setTimeout(function() {
                    restoreInputState();
                    evaluateInputs();
                    if (areInputsValid) {
                        startCompute();
                    }
                    if (hasLocalStorage()) {
                        var panel = localStorage.getItem("panel");
                        if (panel && panel !== "welcome") {
                            setTabPanel(panel);
                        }
                    }
                }, 0);

            });

        </script>

    </body>
</html>
